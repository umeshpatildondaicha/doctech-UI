import { Injectable } from '@angular/core';
import { HttpHeaders, HttpEventType, HttpParams, } from '@angular/common/http';
import { ResponseType, Observe } from './../enums/http.enum';
import * as i0 from "@angular/core";
/**
 * Injectable service for HTTP utilities
 */
/**
 * HttpUtilService
 */
export class HttpUtilService {
    /**
     * constructor
     */
    constructor() { }
    /**
     * Gets the upload progress
     * @param event - The HTTP event
     * @returns The upload progress
     */
    getUploadProgress(event) {
        switch (event.type) {
            case HttpEventType.UploadProgress:
                const progress = Math.round((100 * event.loaded) / (event.total ?? 1));
                return { status: 'progress', message: progress };
            case HttpEventType.Response:
                return event.body;
            default:
                return `Unhandled event: ${event.type}`;
        }
    }
    /**
     * Gets the download progress
     * @param event - The HTTP event
     * @returns The download progress
     */
    getDownloadProgress(event) {
        switch (event.type) {
            case HttpEventType.ResponseHeader:
                return { headers: event.headers, type: event.type };
            case HttpEventType.DownloadProgress:
                const progress = Math.round((100 * event.loaded) / 100);
                return { status: 'progress', message: progress };
            case HttpEventType.Response:
                return event.body;
            default:
                return `Unhandled event: ${event.type}`;
        }
    }
    /**
     * Saves a downloaded file
     * @param content - The content of the file
     * @param response - The response from the server
     * @param contentType - The content type of the file
     * @param filename - The name of the file
     * @returns The name of the file
     */
    saveDownloadedFile(content, response, contentType, filename) {
        const linkElement = document.createElement('a');
        try {
            let blob = null;
            let url = null;
            blob = new Blob([response], {
                type: contentType,
            });
            if (!filename) {
                if (content?.includes("filename*=utf-8''")) {
                    let tempData = content.split(';');
                    let fName = '';
                    tempData.forEach((item) => {
                        if (item?.includes("filename*=utf-8''") &&
                            item.split("filename*=utf-8''").length > 0) {
                            fName = decodeURI(item.split("filename*=utf-8''")[1]);
                        }
                    });
                    filename = fName;
                }
                else {
                    filename = content ? content.split('=')[1] : null;
                    filename = filename ? filename.split(';')[0] : null;
                    filename = filename ? filename.trim() : null;
                    if (filename && filename.indexOf('"') > -1) {
                        filename = filename.replace(/"/g, '');
                    }
                }
                if (!content && !filename) {
                    filename = "data";
                }
            }
            if (filename) {
                filename = decodeURIComponent(encodeURI(filename));
                url = window.URL.createObjectURL(blob);
                linkElement.setAttribute('href', url);
                linkElement.setAttribute('download', filename);
                const clickEvent = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: false,
                });
                linkElement.dispatchEvent(clickEvent);
                return filename;
            }
            else {
                return null;
            }
        }
        catch (ex) {
            return ex instanceof Error ? ex.message : 'Unknown error';
        }
    }
    /**
     * Gets the download upload progress box
     * @param type - The type of the file
     * @param url - The URL of the file
     * @param fileName - The name of the file
     * @returns The download upload progress box
     */
    getDownloadUploadProgressBox(type, url, fileName) {
        const uldlData = {};
        uldlData.url = url;
        uldlData.type = type;
        uldlData.size = 0;
        uldlData.progress = 0;
        uldlData.fileName = fileName ? fileName : undefined;
        return uldlData;
    }
    /**
     * Gets the HTTP options
     * @param options - The HTTP options
     * @returns The HTTP options
     */
    getHttpOptions(options = {}) {
        const { headers = {}, observe = Observe.BODY, reportProgress = false, responseType = ResponseType.JSON, 
        // withCredentials = true,
        params = new HttpParams(), } = options;
        return {
            headers: this.getHttpHeaders(headers),
            params: params,
            observe: observe,
            reportProgress: reportProgress,
            responseType: responseType,
            // withCredentials: withCredentials,
        };
    }
    /**
     * Gets the HTTP headers
     * @param headers
     * @returns HttpHeaders
     */
    getHttpHeaders(headers) {
        if (headers instanceof HttpHeaders) {
            return headers;
        }
        return new HttpHeaders({
            'Content-Type': 'application/json',
            // withCredentials: 'true',
            // "Access-Control-Allow-Origin" : "*",
            ...headers,
        });
    }
    /**
     * Handles an error
     * @param err - The error
     */
    errorHandler(err) {
        if (err.error instanceof Error) {
            // A client-side or network error occurred.
            // this.messageBox.error('client side error: ' + err.error.message);
        }
        else {
            // Backend returns unsuccessful response codes such as 404, 500 etc.
            if (err &&
                err.error &&
                (err.error.code === -4 ||
                    err.error.code === -5 ||
                    err.error.code === -6 ||
                    (err.error.hasOwnProperty('errors') &&
                        err.error.errors &&
                        err.error.errors.length))) {
                this.showServeError(err.error);
                return;
            }
        }
    }
    /**
     * Shows a server error
     * @param err - The error
     */
    showServeError(err) {
        if (err.hasOwnProperty('errors') && err.errors && err.errors.length) {
            // this.messageBox.error(err.errors[0]);
        }
    }
    /**
     * showLoader
     */
    showLoader() {
        // this.loader.show();
    }
    /**
     * hideLoader
     */
    hideLoader() {
        // this.loader.hide();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: HttpUtilService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: HttpUtilService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: HttpUtilService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC11dGlsLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9jb21tb24tbGlicy9jb3JlL3NyYy9saWIvc2VydmljZXMvaHR0cC11dGlsLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQ0wsV0FBVyxFQUNYLGFBQWEsRUFDYixVQUFVLEdBRVgsTUFBTSxzQkFBc0IsQ0FBQztBQUU5QixPQUFPLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDOztBQUU3RDs7R0FFRztBQUlIOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGVBQWU7SUFDMUI7O09BRUc7SUFDSCxnQkFBZSxDQUFDO0lBRWhCOzs7O09BSUc7SUFDSCxpQkFBaUIsQ0FBQyxLQUFxQjtRQUNyQyxRQUFRLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNuQixLQUFLLGFBQWEsQ0FBQyxjQUFjO2dCQUMvQixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLElBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxDQUFDO1lBQ25ELEtBQUssYUFBYSxDQUFDLFFBQVE7Z0JBQ3pCLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQztZQUNwQjtnQkFDRSxPQUFPLG9CQUFvQixLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDNUMsQ0FBQztJQUNILENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsbUJBQW1CLENBQUMsS0FBcUI7UUFDdkMsUUFBUSxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDbkIs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QyxDQUFDO29CQUNyQixHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUM7b0JBQ3JCLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDO3dCQUNqQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU07d0JBQ2hCLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQzdCLENBQUM7Z0JBQ0QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQy9CLE9BQU87WUFDVCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRDs7O09BR0c7SUFDSyxjQUFjLENBQUMsR0FBUTtRQUM3QixJQUFJLEdBQUcsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxDQUFDLE1BQU0sSUFBSSxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3BFLHdDQUF3QztRQUMxQyxDQUFDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsVUFBVTtRQUNSLHNCQUFzQjtJQUN4QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxVQUFVO1FBQ1Isc0JBQXNCO0lBQ3hCLENBQUM7K0dBdE5VLGVBQWU7bUhBQWYsZUFBZSxjQUxkLE1BQU07OzRGQUtQLGVBQWU7a0JBTjNCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSVVMRExQcm9ncmVzc0luZm8gfSBmcm9tICcuLy4uL2ludGVyZmFjZXMvdWxkbHByb2dyZXNzLWluZm8nO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgSHR0cEhlYWRlcnMsXG4gIEh0dHBFdmVudFR5cGUsXG4gIEh0dHBQYXJhbXMsXG4gIEh0dHBFdmVudCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSUh0dHBPcHRpb25zIH0gZnJvbSAnLi8uLi9pbnRlcmZhY2VzL2h0dHAnO1xuaW1wb3J0IHsgUmVzcG9uc2VUeXBlLCBPYnNlcnZlIH0gZnJvbSAnLi8uLi9lbnVtcy9odHRwLmVudW0nO1xuXG4vKipcbiAqIEluamVjdGFibGUgc2VydmljZSBmb3IgSFRUUCB1dGlsaXRpZXNcbiAqL1xuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuLyoqXG4gKiBIdHRwVXRpbFNlcnZpY2VcbiAqL1xuZXhwb3J0IGNsYXNzIEh0dHBVdGlsU2VydmljZSB7XG4gIC8qKlxuICAgKiBjb25zdHJ1Y3RvclxuICAgKi9cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSB1cGxvYWQgcHJvZ3Jlc3NcbiAgICogQHBhcmFtIGV2ZW50IC0gVGhlIEhUVFAgZXZlbnRcbiAgICogQHJldHVybnMgVGhlIHVwbG9hZCBwcm9ncmVzc1xuICAgKi9cbiAgZ2V0VXBsb2FkUHJvZ3Jlc3MoZXZlbnQ6IEh0dHBFdmVudDxhbnk+KSB7XG4gICAgc3dpdGNoIChldmVudC50eXBlKSB7XG4gICAgICBjYXNlIEh0dHBFdmVudFR5cGUuVXBsb2FkUHJvZ3Jlc3M6XG4gICAgICAgIGNvbnN0IHByb2dyZXNzID0gTWF0aC5yb3VuZCgoMTAwICogZXZlbnQubG9hZGVkKSAvIChldmVudC50b3RhbD8/IDEpKTtcbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiAncHJvZ3Jlc3MnLCBtZXNzYWdlOiBwcm9ncmVzcyB9O1xuICAgICAgY2FzZSBIdHRwRXZlbnRUeXBlLlJlc3BvbnNlOlxuICAgICAgICByZXR1cm4gZXZlbnQuYm9keTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBgVW5oYW5kbGVkIGV2ZW50OiAke2V2ZW50LnR5cGV9YDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgZG93bmxvYWQgcHJvZ3Jlc3NcbiAgICogQHBhcmFtIGV2ZW50IC0gVGhlIEhUVFAgZXZlbnRcbiAgICogQHJldHVybnMgVGhlIGRvd25sb2FkIHByb2dyZXNzXG4gICAqL1xuICBnZXREb3dubG9hZFByb2dyZXNzKGV2ZW50OiBIdHRwRXZlbnQ8YW55Pikge1xuICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xuICAgICAgY2FzZSBIdHRwRXZlbnRUeXBlLlJlc3BvbnNlSGVhZGVyOlxuICAgICAgICByZXR1cm4geyBoZWFkZXJzOiBldmVudC5oZWFkZXJzLCB0eXBlOiBldmVudC50eXBlIH07XG4gICAgICBjYXNlIEh0dHBFdmVudFR5cGUuRG93bmxvYWRQcm9ncmVzczpcbiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKCgxMDAgKiBldmVudC5sb2FkZWQpIC8gMTAwKTtcbiAgICAgICAgcmV0dXJuIHsgc3RhdHVzOiAncHJvZ3Jlc3MnLCBtZXNzYWdlOiBwcm9ncmVzcyB9O1xuICAgICAgY2FzZSBIdHRwRXZlbnRUeXBlLlJlc3BvbnNlOlxuICAgICAgICByZXR1cm4gZXZlbnQuYm9keTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBgVW5oYW5kbGVkIGV2ZW50OiAke2V2ZW50LnR5cGV9YDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2F2ZXMgYSBkb3dubG9hZGVkIGZpbGVcbiAgICogQHBhcmFtIGNvbnRlbnQgLSBUaGUgY29udGVudCBvZiB0aGUgZmlsZVxuICAgKiBAcGFyYW0gcmVzcG9uc2UgLSBUaGUgcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyXG4gICAqIEBwYXJhbSBjb250ZW50VHlwZSAtIFRoZSBjb250ZW50IHR5cGUgb2YgdGhlIGZpbGVcbiAgICogQHBhcmFtIGZpbGVuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIGZpbGVcbiAgICogQHJldHVybnMgVGhlIG5hbWUgb2YgdGhlIGZpbGVcbiAgICovXG4gIHNhdmVEb3dubG9hZGVkRmlsZShcbiAgICBjb250ZW50OiBhbnksXG4gICAgcmVzcG9uc2U6IGFueSxcbiAgICBjb250ZW50VHlwZTogc3RyaW5nLFxuICAgIGZpbGVuYW1lPzogYW55XG4gICk6IHN0cmluZyB8IG51bGwge1xuICAgIGNvbnN0IGxpbmtFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgIHRyeSB7XG4gICAgICBsZXQgYmxvYiA9IG51bGw7XG4gICAgICBsZXQgdXJsID0gbnVsbDtcbiAgICAgIGJsb2IgPSBuZXcgQmxvYihbcmVzcG9uc2VdLCB7XG4gICAgICAgIHR5cGU6IGNvbnRlbnRUeXBlLFxuICAgICAgfSk7XG4gICAgICBpZiAoIWZpbGVuYW1lKSB7XG4gICAgICAgIGlmIChjb250ZW50Py5pbmNsdWRlcyhcImZpbGVuYW1lKj11dGYtOCcnXCIpKSB7XG4gICAgICAgICAgbGV0IHRlbXBEYXRhID0gY29udGVudC5zcGxpdCgnOycpO1xuICAgICAgICAgIGxldCBmTmFtZSA9ICcnO1xuICAgICAgICAgIHRlbXBEYXRhLmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBpdGVtPy5pbmNsdWRlcyhcImZpbGVuYW1lKj11dGYtOCcnXCIpICYmXG4gICAgICAgICAgICAgIGl0ZW0uc3BsaXQoXCJmaWxlbmFtZSo9dXRmLTgnJ1wiKS5sZW5ndGggPiAwXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgZk5hbWUgPSBkZWNvZGVVUkkoaXRlbS5zcGxpdChcImZpbGVuYW1lKj11dGYtOCcnXCIpWzFdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBmaWxlbmFtZSA9IGZOYW1lO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZpbGVuYW1lID0gY29udGVudCA/IGNvbnRlbnQuc3BsaXQoJz0nKVsxXSA6IG51bGw7XG4gICAgICAgICAgZmlsZW5hbWUgPSBmaWxlbmFtZSA/IGZpbGVuYW1lLnNwbGl0KCc7JylbMF0gOiBudWxsO1xuICAgICAgICAgIGZpbGVuYW1lID0gZmlsZW5hbWUgPyBmaWxlbmFtZS50cmltKCkgOiBudWxsO1xuICAgICAgICAgIGlmIChmaWxlbmFtZSAmJiBmaWxlbmFtZS5pbmRleE9mKCdcIicpID4gLTEpIHtcbiAgICAgICAgICAgIGZpbGVuYW1lID0gZmlsZW5hbWUucmVwbGFjZSgvXCIvZywgJycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbnRlbnQgJiYgIWZpbGVuYW1lKSB7XG4gICAgICAgICAgZmlsZW5hbWUgPSBcImRhdGFcIjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGZpbGVuYW1lKSB7XG4gICAgICAgIGZpbGVuYW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KGVuY29kZVVSSShmaWxlbmFtZSkpO1xuICAgICAgICB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgbGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKCdocmVmJywgdXJsKTtcbiAgICAgICAgbGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIGZpbGVuYW1lKTtcbiAgICAgICAgY29uc3QgY2xpY2tFdmVudCA9IG5ldyBNb3VzZUV2ZW50KCdjbGljaycsIHtcbiAgICAgICAgICB2aWV3OiB3aW5kb3csXG4gICAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgICBjYW5jZWxhYmxlOiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGxpbmtFbGVtZW50LmRpc3BhdGNoRXZlbnQoY2xpY2tFdmVudCk7XG4gICAgICAgIHJldHVybiBmaWxlbmFtZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICByZXR1cm4gZXggaW5zdGFuY2VvZiBFcnJvciA/IGV4Lm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcic7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGRvd25sb2FkIHVwbG9hZCBwcm9ncmVzcyBib3hcbiAgICogQHBhcmFtIHR5cGUgLSBUaGUgdHlwZSBvZiB0aGUgZmlsZVxuICAgKiBAcGFyYW0gdXJsIC0gVGhlIFVSTCBvZiB0aGUgZmlsZVxuICAgKiBAcGFyYW0gZmlsZU5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgZmlsZVxuICAgKiBAcmV0dXJucyBUaGUgZG93bmxvYWQgdXBsb2FkIHByb2dyZXNzIGJveFxuICAgKi9cbiAgZ2V0RG93bmxvYWRVcGxvYWRQcm9ncmVzc0JveCh0eXBlOiBzdHJpbmcsIHVybDogc3RyaW5nLCBmaWxlTmFtZT86IHN0cmluZykge1xuICAgIGNvbnN0IHVsZGxEYXRhOiBJVUxETFByb2dyZXNzSW5mbyA9IHt9O1xuICAgIHVsZGxEYXRhLnVybCA9IHVybDtcbiAgICB1bGRsRGF0YS50eXBlID0gdHlwZTtcbiAgICB1bGRsRGF0YS5zaXplID0gMDtcbiAgICB1bGRsRGF0YS5wcm9ncmVzcyA9IDA7XG4gICAgdWxkbERhdGEuZmlsZU5hbWUgPSBmaWxlTmFtZSA/IGZpbGVOYW1lIDogdW5kZWZpbmVkO1xuICAgIHJldHVybiB1bGRsRGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBIVFRQIG9wdGlvbnNcbiAgICogQHBhcmFtIG9wdGlvbnMgLSBUaGUgSFRUUCBvcHRpb25zXG4gICAqIEByZXR1cm5zIFRoZSBIVFRQIG9wdGlvbnNcbiAgICovXG4gIGdldEh0dHBPcHRpb25zKG9wdGlvbnM6IElIdHRwT3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3Qge1xuICAgICAgaGVhZGVycyA9IHt9LFxuICAgICAgb2JzZXJ2ZSA9IE9ic2VydmUuQk9EWSxcbiAgICAgIHJlcG9ydFByb2dyZXNzID0gZmFsc2UsXG4gICAgICByZXNwb25zZVR5cGUgPSBSZXNwb25zZVR5cGUuSlNPTixcbiAgICAgIC8vIHdpdGhDcmVkZW50aWFscyA9IHRydWUsXG4gICAgICBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpLFxuICAgIH0gPSBvcHRpb25zO1xuICAgIHJldHVybiB7XG4gICAgICBoZWFkZXJzOiB0aGlzLmdldEh0dHBIZWFkZXJzKGhlYWRlcnMpLFxuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICBvYnNlcnZlOiBvYnNlcnZlIGFzICdib2R5JyxcbiAgICAgIHJlcG9ydFByb2dyZXNzOiByZXBvcnRQcm9ncmVzcyxcbiAgICAgIHJlc3BvbnNlVHlwZTogcmVzcG9uc2VUeXBlIGFzICdhcnJheWJ1ZmZlcicsXG4gICAgICAvLyB3aXRoQ3JlZGVudGlhbHM6IHdpdGhDcmVkZW50aWFscyxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIEhUVFAgaGVhZGVyc1xuICAgKiBAcGFyYW0gaGVhZGVycyBcbiAgICogQHJldHVybnMgSHR0cEhlYWRlcnNcbiAgICovXG4gIGdldEh0dHBIZWFkZXJzKGhlYWRlcnM6IGFueSk6IEh0dHBIZWFkZXJzIHtcbiAgICBpZiAoaGVhZGVycyBpbnN0YW5jZW9mIEh0dHBIZWFkZXJzKSB7XG4gICAgICByZXR1cm4gaGVhZGVycztcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBIdHRwSGVhZGVycyh7XG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgLy8gd2l0aENyZWRlbnRpYWxzOiAndHJ1ZScsXG4gICAgICAvLyBcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiIDogXCIqXCIsXG4gICAgICAuLi5oZWFkZXJzLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgYW4gZXJyb3JcbiAgICogQHBhcmFtIGVyciAtIFRoZSBlcnJvclxuICAgKi9cbiAgZXJyb3JIYW5kbGVyKGVycjogYW55KSB7XG4gICAgaWYgKGVyci5lcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAvLyBBIGNsaWVudC1zaWRlIG9yIG5ldHdvcmsgZXJyb3Igb2NjdXJyZWQuXG4gICAgICAvLyB0aGlzLm1lc3NhZ2VCb3guZXJyb3IoJ2NsaWVudCBzaWRlIGVycm9yOiAnICsgZXJyLmVycm9yLm1lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBCYWNrZW5kIHJldHVybnMgdW5zdWNjZXNzZnVsIHJlc3BvbnNlIGNvZGVzIHN1Y2ggYXMgNDA0LCA1MDAgZXRjLlxuICAgICAgaWYgKFxuICAgICAgICBlcnIgJiZcbiAgICAgICAgZXJyLmVycm9yICYmXG4gICAgICAgIChlcnIuZXJyb3IuY29kZSA9PT0gLTQgfHxcbiAgICAgICAgICBlcnIuZXJyb3IuY29kZSA9PT0gLTUgfHxcbiAgICAgICAgICBlcnIuZXJyb3IuY29kZSA9PT0gLTYgfHxcbiAgICAgICAgICAoZXJyLmVycm9yLmhhc093blByb3BlcnR5KCdlcnJvcnMnKSAmJlxuICAgICAgICAgICAgZXJyLmVycm9yLmVycm9ycyAmJlxuICAgICAgICAgICAgZXJyLmVycm9yLmVycm9ycy5sZW5ndGgpKVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuc2hvd1NlcnZlRXJyb3IoZXJyLmVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93cyBhIHNlcnZlciBlcnJvclxuICAgKiBAcGFyYW0gZXJyIC0gVGhlIGVycm9yXG4gICAqL1xuICBwcml2YXRlIHNob3dTZXJ2ZUVycm9yKGVycjogYW55KSB7XG4gICAgaWYgKGVyci5oYXNPd25Qcm9wZXJ0eSgnZXJyb3JzJykgJiYgZXJyLmVycm9ycyAmJiBlcnIuZXJyb3JzLmxlbmd0aCkge1xuICAgICAgLy8gdGhpcy5tZXNzYWdlQm94LmVycm9yKGVyci5lcnJvcnNbMF0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBzaG93TG9hZGVyXG4gICAqL1xuICBzaG93TG9hZGVyKCk6IHZvaWQge1xuICAgIC8vIHRoaXMubG9hZGVyLnNob3coKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBoaWRlTG9hZGVyXG4gICAqL1xuICBoaWRlTG9hZGVyKCk6IHZvaWQge1xuICAgIC8vIHRoaXMubG9hZGVyLmhpZGUoKTtcbiAgfVxufVxuIl19