/**
 * Authentication Service for Shree Clinic Management System
 * Following enterprise-level standards with proper error handling, state management, and security
 */
import { Injectable, inject, Inject, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { BehaviorSubject, throwError, of } from 'rxjs';
import { catchError, tap, map } from 'rxjs/operators';
import { Router } from '@angular/router';
import { HttpClient, HttpErrorResponse } from '@angular/common/http';
import { ApiConfigService } from './api-config.service';
import { UserType } from '../interfaces/auth.interface';
import * as i0 from "@angular/core";
/**
 * Service responsible for handling all authentication-related operations
 */
export class AuthService {
    constructor(platformId) {
        this.platformId = platformId;
        this.http = inject(HttpClient);
        this.router = inject(Router);
        this.apiConfig = inject(ApiConfigService);
        // Private subjects for state management
        this._authState = new BehaviorSubject({
            currentUser: null,
            isLoading: false,
            error: null,
            isAuthenticated: false
        });
        // Public observables for components to subscribe to
        this.authState$ = this._authState.asObservable();
        this.currentUser$ = this.authState$.pipe(map(state => state.currentUser));
        this.isAuthenticated$ = this.authState$.pipe(map(state => state.isAuthenticated));
        this.isLoading$ = this.authState$.pipe(map(state => state.isLoading));
        this.error$ = this.authState$.pipe(map(state => state.error));
        // Constants
        this.TOKEN_KEY = 'auth_token';
        this.REFRESH_TOKEN_KEY = 'refresh_token';
        this.USER_KEY = 'user_data';
        this.REMEMBER_ME_KEY = 'remember_me';
        this.initializeAuthState();
    }
    /**
     * Initialize authentication state from stored data
     */
    initializeAuthState() {
        try {
            const token = this.getStoredToken();
            const user = this.getStoredUser();
            const rememberMe = this.getRememberMeStatus();
            if (token && user && this.isTokenValid(token)) {
                const currentUser = {
                    user,
                    token,
                    tokenExpiresAt: this.getTokenExpiration(token),
                    isAuthenticated: true,
                    userType: user.userType
                };
                this.updateAuthState({
                    currentUser,
                    isLoading: false,
                    error: null,
                    isAuthenticated: true
                });
            }
            else if (token && user && !this.isTokenValid(token)) {
                // Token is expired, but we have user data - attempt to refresh
                const refreshToken = this.getStoredRefreshToken();
                if (refreshToken) {
                    // Keep user authenticated while attempting refresh
                    const currentUser = {
                        user,
                        token,
                        tokenExpiresAt: this.getTokenExpiration(token),
                        isAuthenticated: true,
                        userType: user.userType
                    };
                    this.updateAuthState({
                        currentUser,
                        isLoading: true,
                        error: null,
                        isAuthenticated: true
                    });
                    // Attempt to refresh token in background
                    this.refreshToken().subscribe({
                        next: (success) => {
                            if (!success) {
                                // Refresh failed, clear auth data
                                this.clearStoredAuthData();
                                this.updateAuthState({
                                    currentUser: null,
                                    isLoading: false,
                                    error: null,
                                    isAuthenticated: false
                                });
                            }
                            // If refresh succeeds, handleSuccessfulLogin will update the state
                        },
                        error: () => {
                            // Refresh failed, clear auth data
                            this.clearStoredAuthData();
                            this.updateAuthState({
                                currentUser: null,
                                isLoading: false,
                                error: null,
                                isAuthenticated: false
                            });
                        }
                    });
                }
                else {
                    // No refresh token available, but keep user authenticated
                    // Let the guard decide whether to allow access or redirect
                    // This prevents clearing data before the guard can check
                    const currentUser = {
                        user,
                        token,
                        tokenExpiresAt: this.getTokenExpiration(token),
                        isAuthenticated: true,
                        userType: user.userType
                    };
                    this.updateAuthState({
                        currentUser,
                        isLoading: false,
                        error: null,
                        isAuthenticated: true
                    });
                }
            }
            else {
                // No token or user data
                this.clearStoredAuthData();
                this.updateAuthState({
                    currentUser: null,
                    isLoading: false,
                    error: null,
                    isAuthenticated: false
                });
            }
        }
        catch (error) {
            console.error('Error initializing auth state:', error);
            this.clearStoredAuthData();
            this.updateAuthState({
                currentUser: null,
                isLoading: false,
                error: 'Failed to restore authentication state',
                isAuthenticated: false
            });
        }
    }
    /**
     * Authenticate user with email and password
     */
    login(loginRequest, rememberMe = false) {
        // Reset state and set loading
        this.updateAuthState({
            currentUser: null,
            isLoading: true,
            error: null,
            isAuthenticated: false
        });
        // Create HTTP options with proper headers
        const httpOptions = {
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            withCredentials: false
        };
        const apiUrl = this.apiConfig.getApiUrl();
        console.log('Login request:', {
            url: `${apiUrl}/api/auth/login`,
            email: loginRequest.email,
            rememberMe
        });
        return this.http.post(`${apiUrl}/api/auth/login`, loginRequest, httpOptions).pipe(tap((response) => {
            console.log('Login response received');
            // Validate response has required data
            if (!response) {
                throw new Error('Empty response from server');
            }
            this.handleSuccessfulLogin(response, rememberMe);
        }), map(() => {
            // Verify authentication was successful
            const isAuth = this.isAuthenticated();
            if (!isAuth) {
                throw new Error('Authentication failed - user not authenticated after login');
            }
            return true;
        }), catchError((error) => {
            console.error('Login error:', error);
            // Handle HTTP errors
            if (error instanceof HttpErrorResponse) {
                // Handle parsing errors (status 200 but can't parse JSON)
                if (error.status === 200 && error.message.includes('Http failure during parsing')) {
                    const errorMessage = 'Server returned invalid response format';
                    this.updateAuthState({
                        currentUser: null,
                        isLoading: false,
                        error: errorMessage,
                        isAuthenticated: false
                    });
                    return throwError(() => new Error(errorMessage));
                }
                // Check if it's a connection error and try mock login
                if (error.status === 0 || error.status === 502 || error.status === 503) {
                    console.log('Backend server unavailable, attempting mock login...');
                    return this.handleMockLogin(loginRequest, rememberMe);
                }
                const errorMessage = this.handleLoginError(error);
                this.updateAuthState({
                    currentUser: null,
                    isLoading: false,
                    error: errorMessage,
                    isAuthenticated: false
                });
                return throwError(() => new Error(errorMessage));
            }
            // Handle other errors
            const errorMessage = error.message || 'Login failed';
            this.updateAuthState({
                currentUser: null,
                isLoading: false,
                error: errorMessage,
                isAuthenticated: false
            });
            return throwError(() => error);
        }));
    }
    /**
     * Handle successful login response
     */
    handleSuccessfulLogin(response, rememberMe) {
        console.log('Processing login response:', response);
        try {
            // Extract data from response - handle multiple response structures
            const data = response.data || response;
            // Extract token - check multiple possible locations
            const token = data.accessToken || data.token || data.access_token || response.accessToken || response.token;
            if (!token) {
                throw new Error('No access token found in login response');
            }
            // Extract refresh token - check multiple possible locations
            const refreshToken = data.refreshToken || data.refresh_token || response.refreshToken || response.refresh_token;
            console.log('Refresh token found:', !!refreshToken);
            // Extract expiresIn
            const expiresIn = data.expiresIn || data.expires_in || response.expiresIn || 3600;
            const expiresInSeconds = typeof expiresIn === 'number' ? expiresIn : parseInt(expiresIn, 10) || 3600;
            // Extract user data
            let user;
            if (data.user) {
                user = data.user;
            }
            else if (response.user) {
                user = response.user;
            }
            else {
                // Construct user from root level data
                user = {
                    id: data.userId || data.id || response.userId || response.id || '1',
                    email: data.email || response.email || '',
                    fullName: data.fullName || data.name || data.displayName || response.fullName || response.name || 'User',
                    userType: data.userType || data.user_type || response.userType || 'HOSPITAL',
                    profilePicture: data.profilePicture || data.profile_picture || response.profilePicture || 'assets/avatars/default-avatar.jpg',
                    phoneNumber: data.phoneNumber || data.phone_number || response.phoneNumber || '',
                    role: data.role || response.role || 'ADMIN',
                    permissions: data.permissions || response.permissions || [],
                    createdAt: data.createdAt || data.created_at || response.createdAt || new Date().toISOString(),
                    lastLoginAt: data.lastLoginAt || data.last_login_at || response.lastLoginAt || new Date().toISOString(),
                    status: (data.status || data.active || response.status || response.active) ? 'ACTIVE' : 'INACTIVE'
                };
            }
            // Validate required user fields
            if (!user.id || !user.email) {
                throw new Error('Invalid user data in login response');
            }
            // Calculate token expiration
            const tokenExpiresAt = Date.now() + (expiresInSeconds * 1000);
            // Create current user object
            const currentUser = {
                user,
                token,
                tokenExpiresAt,
                isAuthenticated: true,
                userType: user.userType || 'HOSPITAL'
            };
            console.log('Login successful - User:', user.email, 'Type:', currentUser.userType);
            console.log('Token expires at:', new Date(tokenExpiresAt).toISOString());
            console.log('Refresh token stored:', !!refreshToken);
            // Store authentication data FIRST (before state update)
            this.storeAuthData(token, refreshToken, user, rememberMe);
            // Update state AFTER storing data
            this.updateAuthState({
                currentUser,
                isLoading: false,
                error: null,
                isAuthenticated: true
            });
            // Navigation will be handled by the component via authState$ subscription
            // This keeps the service decoupled from routing
        }
        catch (error) {
            console.error('Error processing login response:', error);
            this.updateAuthState({
                currentUser: null,
                isLoading: false,
                error: error.message || 'Failed to process login response',
                isAuthenticated: false
            });
            throw error;
        }
    }
    /**
     * Handle login errors and return appropriate error messages
     */
    handleLoginError(error) {
        console.error('Login error details:', {
            status: error.status,
            statusText: error.statusText,
            message: error.message,
            url: error.url,
            error: error.error
        });
        if (error.status === 0) {
            return 'Unable to connect to the server. Please check if the backend server is running on port 8080.';
        }
        // Check if it's a network error
        if (error.error instanceof ErrorEvent) {
            return 'Network error occurred. Please check your internet connection and ensure the backend server is running.';
        }
        switch (error.status) {
            case 400:
                return 'Invalid login credentials. Please check your email and password.';
            case 401:
                return 'Invalid email or password. Please try again.';
            case 403:
                return 'Account is suspended or inactive. Please contact support.';
            case 404:
                return 'User account not found. Please check your email and user type.';
            case 429:
                return 'Too many login attempts. Please try again later.';
            case 500:
                return 'Server error. Please try again later.';
            case 502:
                return 'Backend server is not responding. Please ensure the server is running on port 8080.';
            case 503:
                return 'Service temporarily unavailable. Please try again later.';
            default:
                return `Server error (${error.status}). Please try again or contact support if the problem persists.`;
        }
    }
    /**
     * Handle mock login when backend is unavailable
     */
    handleMockLogin(loginRequest, rememberMe) {
        // Mock credentials for demo purposes
        const mockCredentials = {
            [UserType.HOSPITAL]: { email: 'u513107@gmail.com', password: 'Shree@123' },
            [UserType.DOCTOR]: { email: 'swapnil@gmail.com', password: 'Swapnil@123' },
            [UserType.PATIENT]: { email: 'patient@shreephysio.com', password: 'Patient@123' }
        };
        // Determine expected credentials by userType if provided, otherwise infer by email
        const expectedByType = loginRequest.userType ? mockCredentials[loginRequest.userType] : undefined;
        const inferredType = !loginRequest.userType
            ? Object.keys(mockCredentials).find((t) => mockCredentials[t].email === loginRequest.email)
            : loginRequest.userType;
        const expectedCredentials = expectedByType || (inferredType ? mockCredentials[inferredType] : undefined);
        if (expectedCredentials &&
            loginRequest.email === expectedCredentials.email &&
            loginRequest.password === expectedCredentials.password) {
            const resolvedType = inferredType || loginRequest.userType || UserType.HOSPITAL;
            console.log('Mock login successful for:', resolvedType);
            // Create mock response
            const getUserInfo = (userType) => {
                switch (userType) {
                    case UserType.DOCTOR:
                        return {
                            id: 'DOC-12332',
                            fullName: 'Dr. Swapnil',
                            phoneNumber: '8788802334'
                        };
                    case UserType.HOSPITAL:
                        return {
                            id: 'ADMIN-001',
                            fullName: 'Hospital Admin',
                            phoneNumber: '+91-22-12345678'
                        };
                    case UserType.PATIENT:
                        return {
                            id: 'PAT-001',
                            fullName: 'John Doe',
                            phoneNumber: '+91-9876543210'
                        };
                    default:
                        return {
                            id: 'USER-001',
                            fullName: 'Demo User',
                            phoneNumber: '+91-0000000000'
                        };
                }
            };
            const userInfo = getUserInfo(resolvedType);
            const mockResponse = {
                success: true,
                message: 'Login successful (Demo Mode)',
                data: {
                    token: 'mock-jwt-token-' + Date.now(),
                    refreshToken: 'mock-refresh-token-' + Date.now(),
                    user: {
                        id: userInfo.id,
                        email: loginRequest.email,
                        fullName: userInfo.fullName,
                        userType: resolvedType,
                        status: 'ACTIVE',
                        phoneNumber: userInfo.phoneNumber,
                        profilePicture: 'assets/avatars/default-avatar.jpg',
                        createdAt: new Date().toISOString(),
                        lastLoginAt: new Date().toISOString()
                    }
                }
            };
            this.handleSuccessfulLogin(mockResponse, rememberMe);
            return of(true);
        }
        else {
            const errorMessage = 'Invalid email or password. Please try again. (Demo Mode)';
            this.updateAuthState({
                ...this._authState.value,
                isLoading: false,
                error: errorMessage
            });
            return throwError(() => new Error(errorMessage));
        }
    }
    /**
     * Navigate user to appropriate dashboard after successful login
     */
    navigateAfterLogin(userType) {
        console.log('Navigating for user type:', userType);
        switch (userType) {
            case 'HOSPITAL':
                console.log('Navigating to admin dashboard');
                this.router.navigate(['/admin-dashboard']);
                break;
            case 'DOCTOR':
                console.log('Navigating to doctor dashboard');
                this.router.navigate(['/dashboard']);
                break;
            case 'PATIENT':
                console.log('Navigating to patient dashboard');
                this.router.navigate(['/patient-dashboard']);
                break;
            default:
                console.log('Default navigation to dashboard');
                this.router.navigate(['/dashboard']);
        }
    }
    /**
     * Logout user and clear all authentication data
     */
    logout() {
        // Clear stored data
        this.clearStoredAuthData();
        // Update state
        this.updateAuthState({
            currentUser: null,
            isLoading: false,
            error: null,
            isAuthenticated: false
        });
        // Navigate to login
        this.router.navigate(['/login']);
    }
    /**
     * Refresh authentication token
     */
    refreshToken() {
        const refreshToken = this.getStoredRefreshToken();
        if (!refreshToken) {
            console.warn('No refresh token available for token refresh');
            return of(false);
        }
        console.log('Attempting to refresh token...');
        const apiUrl = this.apiConfig.getApiUrl();
        return this.http.post(`${apiUrl}/api/auth/refresh`, { refreshToken }).pipe(tap((response) => {
            console.log('Token refresh successful');
            // Use the same login handler to process the refresh response
            this.handleSuccessfulLogin(response, this.getRememberMeStatus());
        }), map(() => true), catchError((error) => {
            console.error('Token refresh failed:', error);
            // Only logout if it's a real auth error, not a network error
            if (error.status === 401 || error.status === 403) {
                console.log('Refresh token invalid, logging out');
                this.logout();
            }
            return of(false);
        }));
    }
    /**
     * Check if current token is valid
     */
    isTokenValid(token) {
        const tokenToCheck = token || this.getStoredToken();
        if (!tokenToCheck) {
            return false;
        }
        try {
            const expiration = this.getTokenExpiration(tokenToCheck);
            return Date.now() < expiration;
        }
        catch {
            return false;
        }
    }
    /**
     * Get token expiration time
     */
    getTokenExpiration(token) {
        try {
            const payload = JSON.parse(atob(token.split('.')[1]));
            return payload.exp * 1000;
        }
        catch {
            return 0;
        }
    }
    /**
     * Get current user information
     */
    getCurrentUser() {
        return this._authState.value.currentUser?.user || null;
    }
    /**
     * Get current user type
     */
    getUserType() {
        return this._authState.value.currentUser?.user.userType || null;
    }
    /**
     * Check if user has specific permission
     */
    hasPermission(permission) {
        const user = this.getCurrentUser();
        return user?.permissions?.includes(permission) || false;
    }
    /**
     * Check if user is of specific type
     */
    isUserType(userType) {
        return this.getUserType() === userType;
    }
    /**
     * Check if user is hospital admin
     */
    isHospitalAdmin() {
        return this.isUserType(UserType.HOSPITAL);
    }
    /**
     * Check if user is doctor
     */
    isDoctor() {
        return this.isUserType(UserType.DOCTOR);
    }
    /**
     * Check if user is patient
     */
    isPatient() {
        return this.isUserType(UserType.PATIENT);
    }
    /**
     * Update authentication state
     */
    updateAuthState(newState) {
        const currentState = this._authState.value;
        const updatedState = { ...currentState, ...newState };
        console.log('Updating auth state:', { currentState, newState, updatedState });
        this._authState.next(updatedState);
    }
    /**
     * Store authentication data in storage
     */
    storeAuthData(token, refreshToken, user, rememberMe) {
        if (!isPlatformBrowser(this.platformId)) {
            return; // Skip localStorage/sessionStorage operations during SSR
        }
        try {
            // Validate token before storing
            if (!token || token === 'dummy-token') {
                console.error('Invalid token provided for storage');
                throw new Error('Invalid token');
            }
            // Preserve existing refresh token if new one is not provided (for token refresh scenarios)
            const existingRefreshToken = this.getStoredRefreshToken();
            const tokenToStore = refreshToken || existingRefreshToken;
            const storage = rememberMe ? localStorage : sessionStorage;
            // Store token
            storage.setItem(this.TOKEN_KEY, token);
            // Store refresh token if available
            if (tokenToStore) {
                storage.setItem(this.REFRESH_TOKEN_KEY, tokenToStore);
                console.log('Refresh token stored in', rememberMe ? 'localStorage' : 'sessionStorage');
            }
            else {
                // Remove refresh token if not provided and not preserving existing
                storage.removeItem(this.REFRESH_TOKEN_KEY);
                console.warn('No refresh token provided or found');
            }
            // Store user data
            storage.setItem(this.USER_KEY, JSON.stringify(user));
            // Store remember me preference
            storage.setItem(this.REMEMBER_ME_KEY, rememberMe ? 'true' : 'false');
            console.log('Auth data stored successfully:', {
                hasToken: !!token,
                hasRefreshToken: !!tokenToStore,
                rememberMe,
                storage: rememberMe ? 'localStorage' : 'sessionStorage'
            });
        }
        catch (error) {
            console.error('Error storing auth data:', error);
            throw error;
        }
    }
    /**
     * Clear all stored authentication data
     */
    clearStoredAuthData() {
        if (!isPlatformBrowser(this.platformId)) {
            return; // Skip localStorage/sessionStorage operations during SSR
        }
        try {
            localStorage.removeItem(this.TOKEN_KEY);
            localStorage.removeItem(this.REFRESH_TOKEN_KEY);
            localStorage.removeItem(this.USER_KEY);
            localStorage.removeItem(this.REMEMBER_ME_KEY);
            sessionStorage.removeItem(this.TOKEN_KEY);
            sessionStorage.removeItem(this.REFRESH_TOKEN_KEY);
            sessionStorage.removeItem(this.USER_KEY);
            sessionStorage.removeItem(this.REMEMBER_ME_KEY);
        }
        catch (error) {
            console.error('Error clearing auth data:', error);
        }
    }
    /**
     * Get stored authentication token
     */
    getStoredToken() {
        if (!isPlatformBrowser(this.platformId)) {
            return null; // Return null during SSR
        }
        try {
            return localStorage.getItem(this.TOKEN_KEY) || sessionStorage.getItem(this.TOKEN_KEY);
        }
        catch {
            return null;
        }
    }
    /**
     * Get stored refresh token
     */
    getStoredRefreshToken() {
        if (!isPlatformBrowser(this.platformId)) {
            return null; // Return null during SSR
        }
        try {
            return localStorage.getItem(this.REFRESH_TOKEN_KEY) || sessionStorage.getItem(this.REFRESH_TOKEN_KEY);
        }
        catch {
            return null;
        }
    }
    /**
     * Get stored user data
     */
    getStoredUser() {
        if (!isPlatformBrowser(this.platformId)) {
            return null; // Return null during SSR
        }
        try {
            const userData = localStorage.getItem(this.USER_KEY) || sessionStorage.getItem(this.USER_KEY);
            return userData ? JSON.parse(userData) : null;
        }
        catch {
            return null;
        }
    }
    /**
     * Get remember me status
     */
    getRememberMeStatus() {
        if (!isPlatformBrowser(this.platformId)) {
            return false; // Return false during SSR
        }
        try {
            return localStorage.getItem(this.REMEMBER_ME_KEY) === 'true' ||
                sessionStorage.getItem(this.REMEMBER_ME_KEY) === 'true';
        }
        catch {
            return false;
        }
    }
    /**
     * Check if user is currently authenticated (synchronous method for guards)
     */
    isAuthenticated() {
        return this._authState.value.isAuthenticated;
    }
    /**
     * Get authentication headers for HTTP requests
     */
    getAuthHeaders() {
        const token = this.getStoredToken();
        return token ? { 'Authorization': `Bearer ${token}` } : {};
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: AuthService, deps: [{ token: PLATFORM_ID }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: AuthService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: AuthService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: () => [{ type: Object, decorators: [{
                    type: Inject,
                    args: [PLATFORM_ID]
                }] }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvY29tbW9uLWxpYnMvY29yZS9zcmMvbGliL3NlcnZpY2VzL2F1dGguc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7QUFFSCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxlQUFlLEVBQWMsVUFBVSxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNuRSxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQWEsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFFLFVBQVUsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRXhELE9BQU8sRUFNTCxRQUFRLEVBRVQsTUFBTSw4QkFBOEIsQ0FBQzs7QUFFdEM7O0dBRUc7QUFJSCxNQUFNLE9BQU8sV0FBVztJQTBCdEIsWUFBeUMsVUFBa0I7UUFBbEIsZUFBVSxHQUFWLFVBQVUsQ0FBUTtRQXpCMUMsU0FBSSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMxQixXQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3hCLGNBQVMsR0FBRyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUV0RCx3Q0FBd0M7UUFDdkIsZUFBVSxHQUFHLElBQUksZUFBZSxDQUFZO1lBQzNELFdBQVcsRUFBRSxJQUFJO1lBQ2pCLFNBQVMsRUFBRSxLQUFLO1lBQ2hC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Q0ksZUFBZTtRQUNwQixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQztJQUMvQyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxjQUFjO1FBQ25CLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUNwQyxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxlQUFlLEVBQUUsVUFBVSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDN0QsQ0FBQzsrR0F6d0JVLFdBQVcsa0JBMEJGLFdBQVc7bUhBMUJwQixXQUFXLGNBRlYsTUFBTTs7NEZBRVAsV0FBVztrQkFIdkIsVUFBVTttQkFBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkI7OzBCQTJCYyxNQUFNOzJCQUFDLFdBQVciLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEF1dGhlbnRpY2F0aW9uIFNlcnZpY2UgZm9yIFNocmVlIENsaW5pYyBNYW5hZ2VtZW50IFN5c3RlbVxuICogRm9sbG93aW5nIGVudGVycHJpc2UtbGV2ZWwgc3RhbmRhcmRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLCBzdGF0ZSBtYW5hZ2VtZW50LCBhbmQgc2VjdXJpdHlcbiAqL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBpbmplY3QsIEluamVjdCwgUExBVEZPUk1fSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgdGhyb3dFcnJvciwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIHRhcCwgbWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEVycm9yUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBBcGlDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi9hcGktY29uZmlnLnNlcnZpY2UnO1xuXG5pbXBvcnQgeyBcbiAgTG9naW5SZXF1ZXN0LCBcbiAgQXV0aFJlc3BvbnNlLCBcbiAgVXNlckluZm8sIFxuICBDdXJyZW50VXNlciwgXG4gIEF1dGhTdGF0ZSwgXG4gIFVzZXJUeXBlLFxuICBBY2NvdW50U3RhdHVzIFxufSBmcm9tICcuLi9pbnRlcmZhY2VzL2F1dGguaW50ZXJmYWNlJztcblxuLyoqXG4gKiBTZXJ2aWNlIHJlc3BvbnNpYmxlIGZvciBoYW5kbGluZyBhbGwgYXV0aGVudGljYXRpb24tcmVsYXRlZCBvcGVyYXRpb25zXG4gKi9cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIEF1dGhTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBodHRwID0gaW5qZWN0KEh0dHBDbGllbnQpO1xuICBwcml2YXRlIHJlYWRvbmx5IHJvdXRlciA9IGluamVjdChSb3V0ZXIpO1xuICBwcml2YXRlIHJlYWRvbmx5IGFwaUNvbmZpZyA9IGluamVjdChBcGlDb25maWdTZXJ2aWNlKTtcblxuICAvLyBQcml2YXRlIHN1YmplY3RzIGZvciBzdGF0ZSBtYW5hZ2VtZW50XG4gIHByaXZhdGUgcmVhZG9ubHkgX2F1dGhTdGF0ZSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8QXV0aFN0YXRlPih7XG4gICAgY3VycmVudFVzZXI6IG51bGwsXG4gICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICBlcnJvcjogbnVsbCxcbiAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZhbHNlXG4gIH0pO1xuXG4gIC8vIFB1YmxpYyBvYnNlcnZhYmxlcyBmb3IgY29tcG9uZW50cyB0byBzdWJzY3JpYmUgdG9cbiAgcHVibGljIHJlYWRvbmx5IGF1dGhTdGF0ZSQgPSB0aGlzLl9hdXRoU3RhdGUuYXNPYnNlcnZhYmxlKCk7XG4gIHB1YmxpYyByZWFkb25seSBjdXJyZW50VXNlciQgPSB0aGlzLmF1dGhTdGF0ZSQucGlwZShtYXAoc3RhdGUgPT4gc3RhdGUuY3VycmVudFVzZXIpKTtcbiAgcHVibGljIHJlYWRvbmx5IGlzQXV0aGVudGljYXRlZCQgPSB0aGlzLmF1dGhTdGF0ZSQucGlwZShtYXAoc3RhdGUgPT4gc3RhdGUuaXNBdXRoZW50aWNhdGVkKSk7XG4gIHB1YmxpYyByZWFkb25seSBpc0xvYWRpbmckID0gdGhpcy5hdXRoU3RhdGUkLnBpcGUobWFwKHN0YXRlID0+IHN0YXRlLmlzTG9hZGluZykpO1xuICBwdWJsaWMgcmVhZG9ubHkgZXJyb3IkID0gdGhpcy5hdXRoU3RhdGUkLnBpcGUobWFwKHN0YXRlID0+IHN0YXRlLmVycm9yKSk7XG5cbiAgLy8gQ29uc3RhbnRzXG4gIHByaXZhdGUgcmVhZG9ubHkgVE9LRU5fS0VZID0gJ2F1dGhfdG9rZW4nO1xuICBwcml2YXRlIHJlYWRvbmx5IFJFRlJFU0hfVE9LRU5fS0VZID0gJ3JlZnJlc2hfdG9rZW4nO1xuICBwcml2YXRlIHJlYWRvbmx5IFVTRVJfS0VZID0gJ3VzZXJfZGF0YSc7XG4gIHByaXZhdGUgcmVhZG9ubHkgUkVNRU1CRVJfTUVfS0VZID0gJ3JlbWVtYmVyX21lJztcblxuICBjb25zdHJ1Y3RvcihASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IE9iamVjdCkge1xuICAgIHRoaXMuaW5pdGlhbGl6ZUF1dGhTdGF0ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgYXV0aGVudGljYXRpb24gc3RhdGUgZnJvbSBzdG9yZWQgZGF0YVxuICAgKi9cbiAgcHJpdmF0ZSBpbml0aWFsaXplQXV0aFN0YXRlKCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2V0U3RvcmVkVG9rZW4oKTtcbiAgICAgIGNvbnN0IHVzZXIgPSB0aGlzLmdldFN0b3JlZFVzZXIoKTtcbiAgICAgIGNvbnN0IHJlbWVtYmVyTWUgPSB0aGlzLmdldFJlbWVtYmVyTWVTdGF0dXMoKTtcblxuICAgICAgaWYgKHRva2VuICYmIHVzZXIgJiYgdGhpcy5pc1Rva2VuVmFsaWQodG9rZW4pKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyOiBDdXJyZW50VXNlciA9IHtcbiAgICAgICAgICB1c2VyLFxuICAgICAgICAgIHRva2VuLFxuICAgICAgICAgIHRva2VuRXhwaXJlc0F0OiB0aGlzLmdldFRva2VuRXhwaXJhdGlvbih0b2tlbiksXG4gICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlLFxuICAgICAgICAgIHVzZXJUeXBlOiB1c2VyLnVzZXJUeXBlXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy51cGRhdGVBdXRoU3RhdGUoe1xuICAgICAgICAgIGN1cnJlbnRVc2VyLFxuICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICh0b2tlbiAmJiB1c2VyICYmICF0aGlzLmlzVG9rZW5WYWxpZCh0b2tlbikpIHtcbiAgICAgICAgLy8gVG9rZW4gaXMgZXhwaXJlZCwgYnV0IHdlIGhhdmUgdXNlciBkYXRhIC0gYXR0ZW1wdCB0byByZWZyZXNoXG4gICAgICAgIGNvbnN0IHJlZnJlc2hUb2tlbiA9IHRoaXMuZ2V0U3RvcmVkUmVmcmVzaFRva2VuKCk7XG4gICAgICAgIGlmIChyZWZyZXNoVG9rZW4pIHtcbiAgICAgICAgICAvLyBLZWVwIHVzZXIgYXV0aGVudGljYXRlZCB3aGlsZSBhdHRlbXB0aW5nIHJlZnJlc2hcbiAgICAgICAgICBjb25zdCBjdXJyZW50VXNlcjogQ3VycmVudFVzZXIgPSB7XG4gICAgICAgICAgICB1c2VyLFxuICAgICAgICAgICAgdG9rZW4sXG4gICAgICAgICAgICB0b2tlbkV4cGlyZXNBdDogdGhpcy5nZXRUb2tlbkV4cGlyYXRpb24odG9rZW4pLFxuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlLFxuICAgICAgICAgICAgdXNlclR5cGU6IHVzZXIudXNlclR5cGVcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgdGhpcy51cGRhdGVBdXRoU3RhdGUoe1xuICAgICAgICAgICAgY3VycmVudFVzZXIsXG4gICAgICAgICAgICBpc0xvYWRpbmc6IHRydWUsXG4gICAgICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgICAgIGlzQXV0aGVudGljYXRlZDogdHJ1ZVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gQXR0ZW1wdCB0byByZWZyZXNoIHRva2VuIGluIGJhY2tncm91bmRcbiAgICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbigpLnN1YnNjcmliZSh7XG4gICAgICAgICAgICBuZXh0OiAoc3VjY2VzcykgPT4ge1xuICAgICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAvLyBSZWZyZXNoIGZhaWxlZCwgY2xlYXIgYXV0aCBkYXRhXG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhclN0b3JlZEF1dGhEYXRhKCk7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVBdXRoU3RhdGUoe1xuICAgICAgICAgICAgICAgICAgY3VycmVudFVzZXI6IG51bGwsXG4gICAgICAgICAgICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgLy8gSWYgcmVmcmVzaCBzdWNjZWVkcywgaGFuZGxlU3VjY2Vzc2Z1bExvZ2luIHdpbGwgdXBkYXRlIHRoZSBzdGF0ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiAoKSA9PiB7XG4gICAgICAgICAgICAgIC8vIFJlZnJlc2ggZmFpbGVkLCBjbGVhciBhdXRoIGRhdGFcbiAgICAgICAgICAgICAgdGhpcy5jbGVhclN0b3JlZEF1dGhEYXRhKCk7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlQXV0aFN0YXRlKHtcbiAgICAgICAgICAgICAgICBjdXJyZW50VXNlcjogbnVsbCxcbiAgICAgICAgICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgICAgICAgIGlzQXV0aGVudGljYXRlZDogZmFsc2VcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gTm8gcmVmcmVzaCB0b2tlbiBhdmFpbGFibGUsIGJ1dCBrZWVwIHVzZXIgYXV0aGVudGljYXRlZFxuICAgICAgICAgIC8vIExldCB0aGUgZ3VhcmQgZGVjaWRlIHdoZXRoZXIgdG8gYWxsb3cgYWNjZXNzIG9yIHJlZGlyZWN0XG4gICAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyBjbGVhcmluZyBkYXRhIGJlZm9yZSB0aGUgZ3VhcmQgY2FuIGNoZWNrXG4gICAgICAgICAgY29uc3QgY3VycmVudFVzZXI6IEN1cnJlbnRVc2VyID0ge1xuICAgICAgICAgICAgdXNlcixcbiAgICAgICAgICAgIHRva2VuLFxuICAgICAgICAgICAgdG9rZW5FeHBpcmVzQXQ6IHRoaXMuZ2V0VG9rZW5FeHBpcmF0aW9uKHRva2VuKSxcbiAgICAgICAgICAgIGlzQXV0aGVudGljYXRlZDogdHJ1ZSxcbiAgICAgICAgICAgIHVzZXJUeXBlOiB1c2VyLnVzZXJUeXBlXG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHRoaXMudXBkYXRlQXV0aFN0YXRlKHtcbiAgICAgICAgICAgIGN1cnJlbnRVc2VyLFxuICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiBudWxsLFxuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE5vIHRva2VuIG9yIHVzZXIgZGF0YVxuICAgICAgICB0aGlzLmNsZWFyU3RvcmVkQXV0aERhdGEoKTtcbiAgICAgICAgdGhpcy51cGRhdGVBdXRoU3RhdGUoe1xuICAgICAgICAgIGN1cnJlbnRVc2VyOiBudWxsLFxuICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5pdGlhbGl6aW5nIGF1dGggc3RhdGU6JywgZXJyb3IpO1xuICAgICAgdGhpcy5jbGVhclN0b3JlZEF1dGhEYXRhKCk7XG4gICAgICB0aGlzLnVwZGF0ZUF1dGhTdGF0ZSh7XG4gICAgICAgIGN1cnJlbnRVc2VyOiBudWxsLFxuICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byByZXN0b3JlIGF1dGhlbnRpY2F0aW9uIHN0YXRlJyxcbiAgICAgICAgaXNBdXRoZW50aWNhdGVkOiBmYWxzZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEF1dGhlbnRpY2F0ZSB1c2VyIHdpdGggZW1haWwgYW5kIHBhc3N3b3JkXG4gICAqL1xuICBwdWJsaWMgbG9naW4obG9naW5SZXF1ZXN0OiBMb2dpblJlcXVlc3QsIHJlbWVtYmVyTWU6IGJvb2xlYW4gPSBmYWxzZSk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIC8vIFJlc2V0IHN0YXRlIGFuZCBzZXQgbG9hZGluZ1xuICAgIHRoaXMudXBkYXRlQXV0aFN0YXRlKHsgXG4gICAgICBjdXJyZW50VXNlcjogbnVsbCxcbiAgICAgIGlzTG9hZGluZzogdHJ1ZSwgXG4gICAgICBlcnJvcjogbnVsbCxcbiAgICAgIGlzQXV0aGVudGljYXRlZDogZmFsc2VcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBIVFRQIG9wdGlvbnMgd2l0aCBwcm9wZXIgaGVhZGVyc1xuICAgIGNvbnN0IGh0dHBPcHRpb25zID0ge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAnWC1SZXF1ZXN0ZWQtV2l0aCc6ICdYTUxIdHRwUmVxdWVzdCdcbiAgICAgIH0sXG4gICAgICB3aXRoQ3JlZGVudGlhbHM6IGZhbHNlXG4gICAgfTtcblxuICAgIGNvbnN0IGFwaVVybCA9IHRoaXMuYXBpQ29uZmlnLmdldEFwaVVybCgpO1xuICAgIGNvbnNvbGUubG9nKCdMb2dpbiByZXF1ZXN0OicsIHtcbiAgICAgIHVybDogYCR7YXBpVXJsfS9hcGkvYXV0aC9sb2dpbmAsXG4gICAgICBlbWFpbDogbG9naW5SZXF1ZXN0LmVtYWlsLFxuICAgICAgcmVtZW1iZXJNZVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0PGFueT4oYCR7YXBpVXJsfS9hcGkvYXV0aC9sb2dpbmAsIGxvZ2luUmVxdWVzdCwgaHR0cE9wdGlvbnMpLnBpcGUoXG4gICAgICB0YXAoKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0xvZ2luIHJlc3BvbnNlIHJlY2VpdmVkJyk7XG4gICAgICAgIC8vIFZhbGlkYXRlIHJlc3BvbnNlIGhhcyByZXF1aXJlZCBkYXRhXG4gICAgICAgIGlmICghcmVzcG9uc2UpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VtcHR5IHJlc3BvbnNlIGZyb20gc2VydmVyJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5oYW5kbGVTdWNjZXNzZnVsTG9naW4ocmVzcG9uc2UsIHJlbWVtYmVyTWUpO1xuICAgICAgfSksXG4gICAgICBtYXAoKCk6IGJvb2xlYW4gPT4ge1xuICAgICAgICAvLyBWZXJpZnkgYXV0aGVudGljYXRpb24gd2FzIHN1Y2Nlc3NmdWxcbiAgICAgICAgY29uc3QgaXNBdXRoID0gdGhpcy5pc0F1dGhlbnRpY2F0ZWQoKTtcbiAgICAgICAgaWYgKCFpc0F1dGgpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCAtIHVzZXIgbm90IGF1dGhlbnRpY2F0ZWQgYWZ0ZXIgbG9naW4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0pLFxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlIHwgRXJyb3IpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcignTG9naW4gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICBcbiAgICAgICAgLy8gSGFuZGxlIEhUVFAgZXJyb3JzXG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEh0dHBFcnJvclJlc3BvbnNlKSB7XG4gICAgICAgICAgLy8gSGFuZGxlIHBhcnNpbmcgZXJyb3JzIChzdGF0dXMgMjAwIGJ1dCBjYW4ndCBwYXJzZSBKU09OKVxuICAgICAgICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDIwMCAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdIdHRwIGZhaWx1cmUgZHVyaW5nIHBhcnNpbmcnKSkge1xuICAgICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gJ1NlcnZlciByZXR1cm5lZCBpbnZhbGlkIHJlc3BvbnNlIGZvcm1hdCc7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUF1dGhTdGF0ZSh7IFxuICAgICAgICAgICAgICBjdXJyZW50VXNlcjogbnVsbCxcbiAgICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwgXG4gICAgICAgICAgICAgIGVycm9yOiBlcnJvck1lc3NhZ2UsXG4gICAgICAgICAgICAgIGlzQXV0aGVudGljYXRlZDogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRocm93RXJyb3IoKCkgPT4gbmV3IEVycm9yKGVycm9yTWVzc2FnZSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGEgY29ubmVjdGlvbiBlcnJvciBhbmQgdHJ5IG1vY2sgbG9naW5cbiAgICAgICAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSAwIHx8IGVycm9yLnN0YXR1cyA9PT0gNTAyIHx8IGVycm9yLnN0YXR1cyA9PT0gNTAzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQmFja2VuZCBzZXJ2ZXIgdW5hdmFpbGFibGUsIGF0dGVtcHRpbmcgbW9jayBsb2dpbi4uLicpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlTW9ja0xvZ2luKGxvZ2luUmVxdWVzdCwgcmVtZW1iZXJNZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IHRoaXMuaGFuZGxlTG9naW5FcnJvcihlcnJvcik7XG4gICAgICAgICAgdGhpcy51cGRhdGVBdXRoU3RhdGUoeyBcbiAgICAgICAgICAgIGN1cnJlbnRVc2VyOiBudWxsLFxuICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwgXG4gICAgICAgICAgICBlcnJvcjogZXJyb3JNZXNzYWdlLFxuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB0aHJvd0Vycm9yKCgpID0+IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gSGFuZGxlIG90aGVyIGVycm9yc1xuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlIHx8ICdMb2dpbiBmYWlsZWQnO1xuICAgICAgICB0aGlzLnVwZGF0ZUF1dGhTdGF0ZSh7IFxuICAgICAgICAgIGN1cnJlbnRVc2VyOiBudWxsLFxuICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsIFxuICAgICAgICAgIGVycm9yOiBlcnJvck1lc3NhZ2UsXG4gICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRocm93RXJyb3IoKCkgPT4gZXJyb3IpO1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBzdWNjZXNzZnVsIGxvZ2luIHJlc3BvbnNlXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZVN1Y2Nlc3NmdWxMb2dpbihyZXNwb25zZTogYW55LCByZW1lbWJlck1lOiBib29sZWFuKTogdm9pZCB7XG4gICAgY29uc29sZS5sb2coJ1Byb2Nlc3NpbmcgbG9naW4gcmVzcG9uc2U6JywgcmVzcG9uc2UpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBFeHRyYWN0IGRhdGEgZnJvbSByZXNwb25zZSAtIGhhbmRsZSBtdWx0aXBsZSByZXNwb25zZSBzdHJ1Y3R1cmVzXG4gICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UuZGF0YSB8fCByZXNwb25zZTtcbiAgICAgIFxuICAgICAgLy8gRXh0cmFjdCB0b2tlbiAtIGNoZWNrIG11bHRpcGxlIHBvc3NpYmxlIGxvY2F0aW9uc1xuICAgICAgY29uc3QgdG9rZW4gPSBkYXRhLmFjY2Vzc1Rva2VuIHx8IGRhdGEudG9rZW4gfHwgZGF0YS5hY2Nlc3NfdG9rZW4gfHwgcmVzcG9uc2UuYWNjZXNzVG9rZW4gfHwgcmVzcG9uc2UudG9rZW47XG4gICAgICBpZiAoIXRva2VuKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gYWNjZXNzIHRva2VuIGZvdW5kIGluIGxvZ2luIHJlc3BvbnNlJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEV4dHJhY3QgcmVmcmVzaCB0b2tlbiAtIGNoZWNrIG11bHRpcGxlIHBvc3NpYmxlIGxvY2F0aW9uc1xuICAgICAgY29uc3QgcmVmcmVzaFRva2VuID0gZGF0YS5yZWZyZXNoVG9rZW4gfHwgZGF0YS5yZWZyZXNoX3Rva2VuIHx8IHJlc3BvbnNlLnJlZnJlc2hUb2tlbiB8fCByZXNwb25zZS5yZWZyZXNoX3Rva2VuO1xuICAgICAgY29uc29sZS5sb2coJ1JlZnJlc2ggdG9rZW4gZm91bmQ6JywgISFyZWZyZXNoVG9rZW4pO1xuXG4gICAgICAvLyBFeHRyYWN0IGV4cGlyZXNJblxuICAgICAgY29uc3QgZXhwaXJlc0luID0gZGF0YS5leHBpcmVzSW4gfHwgZGF0YS5leHBpcmVzX2luIHx8IHJlc3BvbnNlLmV4cGlyZXNJbiB8fCAzNjAwO1xuICAgICAgY29uc3QgZXhwaXJlc0luU2Vjb25kcyA9IHR5cGVvZiBleHBpcmVzSW4gPT09ICdudW1iZXInID8gZXhwaXJlc0luIDogcGFyc2VJbnQoZXhwaXJlc0luLCAxMCkgfHwgMzYwMDtcblxuICAgICAgLy8gRXh0cmFjdCB1c2VyIGRhdGFcbiAgICAgIGxldCB1c2VyOiBVc2VySW5mbztcbiAgICAgIGlmIChkYXRhLnVzZXIpIHtcbiAgICAgICAgdXNlciA9IGRhdGEudXNlcjtcbiAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UudXNlcikge1xuICAgICAgICB1c2VyID0gcmVzcG9uc2UudXNlcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENvbnN0cnVjdCB1c2VyIGZyb20gcm9vdCBsZXZlbCBkYXRhXG4gICAgICAgIHVzZXIgPSB7XG4gICAgICAgICAgaWQ6IGRhdGEudXNlcklkIHx8IGRhdGEuaWQgfHwgcmVzcG9uc2UudXNlcklkIHx8IHJlc3BvbnNlLmlkIHx8ICcxJyxcbiAgICAgICAgICBlbWFpbDogZGF0YS5lbWFpbCB8fCByZXNwb25zZS5lbWFpbCB8fCAnJyxcbiAgICAgICAgICBmdWxsTmFtZTogZGF0YS5mdWxsTmFtZSB8fCBkYXRhLm5hbWUgfHwgZGF0YS5kaXNwbGF5TmFtZSB8fCByZXNwb25zZS5mdWxsTmFtZSB8fCByZXNwb25zZS5uYW1lIHx8ICdVc2VyJyxcbiAgICAgICAgICB1c2VyVHlwZTogZGF0YS51c2VyVHlwZSB8fCBkYXRhLnVzZXJfdHlwZSB8fCByZXNwb25zZS51c2VyVHlwZSB8fCAnSE9TUElUQUwnLFxuICAgICAgICAgIHByb2ZpbGVQaWN0dXJlOiBkYXRhLnByb2ZpbGVQaWN0dXJlIHx8IGRhdGEucHJvZmlsZV9waWN0dXJlIHx8IHJlc3BvbnNlLnByb2ZpbGVQaWN0dXJlIHx8ICdhc3NldHMvYXZhdGFycy9kZWZhdWx0LWF2YXRhci5qcGcnLFxuICAgICAgICAgIHBob25lTnVtYmVyOiBkYXRhLnBob25lTnVtYmVyIHx8IGRhdGEucGhvbmVfbnVtYmVyIHx8IHJlc3BvbnNlLnBob25lTnVtYmVyIHx8ICcnLFxuICAgICAgICAgIHJvbGU6IGRhdGEucm9sZSB8fCByZXNwb25zZS5yb2xlIHx8ICdBRE1JTicsXG4gICAgICAgICAgcGVybWlzc2lvbnM6IGRhdGEucGVybWlzc2lvbnMgfHwgcmVzcG9uc2UucGVybWlzc2lvbnMgfHwgW10sXG4gICAgICAgICAgY3JlYXRlZEF0OiBkYXRhLmNyZWF0ZWRBdCB8fCBkYXRhLmNyZWF0ZWRfYXQgfHwgcmVzcG9uc2UuY3JlYXRlZEF0IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBsYXN0TG9naW5BdDogZGF0YS5sYXN0TG9naW5BdCB8fCBkYXRhLmxhc3RfbG9naW5fYXQgfHwgcmVzcG9uc2UubGFzdExvZ2luQXQgfHwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHN0YXR1czogKGRhdGEuc3RhdHVzIHx8IGRhdGEuYWN0aXZlIHx8IHJlc3BvbnNlLnN0YXR1cyB8fCByZXNwb25zZS5hY3RpdmUpID8gJ0FDVElWRScgOiAnSU5BQ1RJVkUnXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIHVzZXIgZmllbGRzXG4gICAgICBpZiAoIXVzZXIuaWQgfHwgIXVzZXIuZW1haWwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHVzZXIgZGF0YSBpbiBsb2dpbiByZXNwb25zZScpO1xuICAgICAgfVxuXG4gICAgICAvLyBDYWxjdWxhdGUgdG9rZW4gZXhwaXJhdGlvblxuICAgICAgY29uc3QgdG9rZW5FeHBpcmVzQXQgPSBEYXRlLm5vdygpICsgKGV4cGlyZXNJblNlY29uZHMgKiAxMDAwKTtcblxuICAgICAgLy8gQ3JlYXRlIGN1cnJlbnQgdXNlciBvYmplY3RcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyOiBDdXJyZW50VXNlciA9IHtcbiAgICAgICAgdXNlcixcbiAgICAgICAgdG9rZW4sXG4gICAgICAgIHRva2VuRXhwaXJlc0F0LFxuICAgICAgICBpc0F1dGhlbnRpY2F0ZWQ6IHRydWUsXG4gICAgICAgIHVzZXJUeXBlOiB1c2VyLnVzZXJUeXBlIHx8ICdIT1NQSVRBTCdcbiAgICAgIH07XG5cbiAgICAgIGNvbnNvbGUubG9nKCdMb2dpbiBzdWNjZXNzZnVsIC0gVXNlcjonLCB1c2VyLmVtYWlsLCAnVHlwZTonLCBjdXJyZW50VXNlci51c2VyVHlwZSk7XG4gICAgICBjb25zb2xlLmxvZygnVG9rZW4gZXhwaXJlcyBhdDonLCBuZXcgRGF0ZSh0b2tlbkV4cGlyZXNBdCkudG9JU09TdHJpbmcoKSk7XG4gICAgICBjb25zb2xlLmxvZygnUmVmcmVzaCB0b2tlbiBzdG9yZWQ6JywgISFyZWZyZXNoVG9rZW4pO1xuXG4gICAgICAvLyBTdG9yZSBhdXRoZW50aWNhdGlvbiBkYXRhIEZJUlNUIChiZWZvcmUgc3RhdGUgdXBkYXRlKVxuICAgICAgdGhpcy5zdG9yZUF1dGhEYXRhKHRva2VuLCByZWZyZXNoVG9rZW4sIHVzZXIsIHJlbWVtYmVyTWUpO1xuXG4gICAgICAvLyBVcGRhdGUgc3RhdGUgQUZURVIgc3RvcmluZyBkYXRhXG4gICAgICB0aGlzLnVwZGF0ZUF1dGhTdGF0ZSh7XG4gICAgICAgIGN1cnJlbnRVc2VyLFxuICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlXG4gICAgICB9KTtcblxuICAgICAgLy8gTmF2aWdhdGlvbiB3aWxsIGJlIGhhbmRsZWQgYnkgdGhlIGNvbXBvbmVudCB2aWEgYXV0aFN0YXRlJCBzdWJzY3JpcHRpb25cbiAgICAgIC8vIFRoaXMga2VlcHMgdGhlIHNlcnZpY2UgZGVjb3VwbGVkIGZyb20gcm91dGluZ1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHByb2Nlc3NpbmcgbG9naW4gcmVzcG9uc2U6JywgZXJyb3IpO1xuICAgICAgdGhpcy51cGRhdGVBdXRoU3RhdGUoe1xuICAgICAgICBjdXJyZW50VXNlcjogbnVsbCxcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBwcm9jZXNzIGxvZ2luIHJlc3BvbnNlJyxcbiAgICAgICAgaXNBdXRoZW50aWNhdGVkOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGxvZ2luIGVycm9ycyBhbmQgcmV0dXJuIGFwcHJvcHJpYXRlIGVycm9yIG1lc3NhZ2VzXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZUxvZ2luRXJyb3IoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKTogc3RyaW5nIHtcbiAgICBjb25zb2xlLmVycm9yKCdMb2dpbiBlcnJvciBkZXRhaWxzOicsIHtcbiAgICAgIHN0YXR1czogZXJyb3Iuc3RhdHVzLFxuICAgICAgc3RhdHVzVGV4dDogZXJyb3Iuc3RhdHVzVGV4dCxcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICB1cmw6IGVycm9yLnVybCxcbiAgICAgIGVycm9yOiBlcnJvci5lcnJvclxuICAgIH0pO1xuXG4gICAgaWYgKGVycm9yLnN0YXR1cyA9PT0gMCkge1xuICAgICAgcmV0dXJuICdVbmFibGUgdG8gY29ubmVjdCB0byB0aGUgc2VydmVyLiBQbGVhc2UgY2hlY2sgaWYgdGhlIGJhY2tlbmQgc2VydmVyIGlzIHJ1bm5pbmcgb24gcG9ydCA4MDgwLic7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgaXQncyBhIG5ldHdvcmsgZXJyb3JcbiAgICBpZiAoZXJyb3IuZXJyb3IgaW5zdGFuY2VvZiBFcnJvckV2ZW50KSB7XG4gICAgICByZXR1cm4gJ05ldHdvcmsgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSBjaGVjayB5b3VyIGludGVybmV0IGNvbm5lY3Rpb24gYW5kIGVuc3VyZSB0aGUgYmFja2VuZCBzZXJ2ZXIgaXMgcnVubmluZy4nO1xuICAgIH1cblxuICAgIHN3aXRjaCAoZXJyb3Iuc3RhdHVzKSB7XG4gICAgICBjYXNlIDQwMDpcbiAgICAgICAgcmV0dXJuICdJbnZhbGlkIGxvZ2luIGNyZWRlbnRpYWxzLiBQbGVhc2UgY2hlY2sgeW91ciBlbWFpbCBhbmQgcGFzc3dvcmQuJztcbiAgICAgIGNhc2UgNDAxOlxuICAgICAgICByZXR1cm4gJ0ludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuIFBsZWFzZSB0cnkgYWdhaW4uJztcbiAgICAgIGNhc2UgNDAzOlxuICAgICAgICByZXR1cm4gJ0FjY291bnQgaXMgc3VzcGVuZGVkIG9yIGluYWN0aXZlLiBQbGVhc2UgY29udGFjdCBzdXBwb3J0Lic7XG4gICAgICBjYXNlIDQwNDpcbiAgICAgICAgcmV0dXJuICdVc2VyIGFjY291bnQgbm90IGZvdW5kLiBQbGVhc2UgY2hlY2sgeW91ciBlbWFpbCBhbmQgdXNlciB0eXBlLic7XG4gICAgICBjYXNlIDQyOTpcbiAgICAgICAgcmV0dXJuICdUb28gbWFueSBsb2dpbiBhdHRlbXB0cy4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nO1xuICAgICAgY2FzZSA1MDA6XG4gICAgICAgIHJldHVybiAnU2VydmVyIGVycm9yLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLic7XG4gICAgICBjYXNlIDUwMjpcbiAgICAgICAgcmV0dXJuICdCYWNrZW5kIHNlcnZlciBpcyBub3QgcmVzcG9uZGluZy4gUGxlYXNlIGVuc3VyZSB0aGUgc2VydmVyIGlzIHJ1bm5pbmcgb24gcG9ydCA4MDgwLic7XG4gICAgICBjYXNlIDUwMzpcbiAgICAgICAgcmV0dXJuICdTZXJ2aWNlIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLic7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gYFNlcnZlciBlcnJvciAoJHtlcnJvci5zdGF0dXN9KS4gUGxlYXNlIHRyeSBhZ2FpbiBvciBjb250YWN0IHN1cHBvcnQgaWYgdGhlIHByb2JsZW0gcGVyc2lzdHMuYDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIG1vY2sgbG9naW4gd2hlbiBiYWNrZW5kIGlzIHVuYXZhaWxhYmxlXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZU1vY2tMb2dpbihsb2dpblJlcXVlc3Q6IExvZ2luUmVxdWVzdCwgcmVtZW1iZXJNZTogYm9vbGVhbik6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIC8vIE1vY2sgY3JlZGVudGlhbHMgZm9yIGRlbW8gcHVycG9zZXNcbiAgICBjb25zdCBtb2NrQ3JlZGVudGlhbHMgPSB7XG4gICAgICBbVXNlclR5cGUuSE9TUElUQUxdOiB7IGVtYWlsOiAndTUxMzEwN0BnbWFpbC5jb20nLCBwYXNzd29yZDogJ1NocmVlQDEyMycgfSxcbiAgICAgIFtVc2VyVHlwZS5ET0NUT1JdOiB7IGVtYWlsOiAnc3dhcG5pbEBnbWFpbC5jb20nLCBwYXNzd29yZDogJ1N3YXBuaWxAMTIzJyB9LFxuICAgICAgW1VzZXJUeXBlLlBBVElFTlRdOiB7IGVtYWlsOiAncGF0aWVudEBzaHJlZXBoeXNpby5jb20nLCBwYXNzd29yZDogJ1BhdGllbnRAMTIzJyB9XG4gICAgfTtcblxuICAgIC8vIERldGVybWluZSBleHBlY3RlZCBjcmVkZW50aWFscyBieSB1c2VyVHlwZSBpZiBwcm92aWRlZCwgb3RoZXJ3aXNlIGluZmVyIGJ5IGVtYWlsXG4gICAgY29uc3QgZXhwZWN0ZWRCeVR5cGUgPSBsb2dpblJlcXVlc3QudXNlclR5cGUgPyBtb2NrQ3JlZGVudGlhbHNbbG9naW5SZXF1ZXN0LnVzZXJUeXBlXSA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBpbmZlcnJlZFR5cGUgPSAhbG9naW5SZXF1ZXN0LnVzZXJUeXBlXG4gICAgICA/IChPYmplY3Qua2V5cyhtb2NrQ3JlZGVudGlhbHMpIGFzIEFycmF5PGtleW9mIHR5cGVvZiBtb2NrQ3JlZGVudGlhbHM+KS5maW5kKFxuICAgICAgICAgICh0KSA9PiBtb2NrQ3JlZGVudGlhbHNbdF0uZW1haWwgPT09IGxvZ2luUmVxdWVzdC5lbWFpbFxuICAgICAgICApXG4gICAgICA6IGxvZ2luUmVxdWVzdC51c2VyVHlwZTtcbiAgICBjb25zdCBleHBlY3RlZENyZWRlbnRpYWxzID0gZXhwZWN0ZWRCeVR5cGUgfHwgKGluZmVycmVkVHlwZSA/IG1vY2tDcmVkZW50aWFsc1tpbmZlcnJlZFR5cGVdIDogdW5kZWZpbmVkKTtcbiAgICBcbiAgICBpZiAoZXhwZWN0ZWRDcmVkZW50aWFscyAmJiBcbiAgICAgICAgbG9naW5SZXF1ZXN0LmVtYWlsID09PSBleHBlY3RlZENyZWRlbnRpYWxzLmVtYWlsICYmIFxuICAgICAgICBsb2dpblJlcXVlc3QucGFzc3dvcmQgPT09IGV4cGVjdGVkQ3JlZGVudGlhbHMucGFzc3dvcmQpIHtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzb2x2ZWRUeXBlID0gaW5mZXJyZWRUeXBlIHx8IGxvZ2luUmVxdWVzdC51c2VyVHlwZSB8fCBVc2VyVHlwZS5IT1NQSVRBTDtcbiAgICAgIGNvbnNvbGUubG9nKCdNb2NrIGxvZ2luIHN1Y2Nlc3NmdWwgZm9yOicsIHJlc29sdmVkVHlwZSk7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBtb2NrIHJlc3BvbnNlXG4gICAgICBjb25zdCBnZXRVc2VySW5mbyA9ICh1c2VyVHlwZTogc3RyaW5nKSA9PiB7XG4gICAgICAgIHN3aXRjaCAodXNlclR5cGUpIHtcbiAgICAgICAgICBjYXNlIFVzZXJUeXBlLkRPQ1RPUjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGlkOiAnRE9DLTEyMzMyJyxcbiAgICAgICAgICAgICAgZnVsbE5hbWU6ICdEci4gU3dhcG5pbCcsXG4gICAgICAgICAgICAgIHBob25lTnVtYmVyOiAnODc4ODgwMjMzNCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgY2FzZSBVc2VyVHlwZS5IT1NQSVRBTDpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGlkOiAnQURNSU4tMDAxJyxcbiAgICAgICAgICAgICAgZnVsbE5hbWU6ICdIb3NwaXRhbCBBZG1pbicsXG4gICAgICAgICAgICAgIHBob25lTnVtYmVyOiAnKzkxLTIyLTEyMzQ1Njc4J1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICBjYXNlIFVzZXJUeXBlLlBBVElFTlQ6XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBpZDogJ1BBVC0wMDEnLFxuICAgICAgICAgICAgICBmdWxsTmFtZTogJ0pvaG4gRG9lJyxcbiAgICAgICAgICAgICAgcGhvbmVOdW1iZXI6ICcrOTEtOTg3NjU0MzIxMCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGlkOiAnVVNFUi0wMDEnLFxuICAgICAgICAgICAgICBmdWxsTmFtZTogJ0RlbW8gVXNlcicsXG4gICAgICAgICAgICAgIHBob25lTnVtYmVyOiAnKzkxLTAwMDAwMDAwMDAnXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCB1c2VySW5mbyA9IGdldFVzZXJJbmZvKHJlc29sdmVkVHlwZSk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1vY2tSZXNwb25zZSA9IHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ0xvZ2luIHN1Y2Nlc3NmdWwgKERlbW8gTW9kZSknLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdG9rZW46ICdtb2NrLWp3dC10b2tlbi0nICsgRGF0ZS5ub3coKSxcbiAgICAgICAgICByZWZyZXNoVG9rZW46ICdtb2NrLXJlZnJlc2gtdG9rZW4tJyArIERhdGUubm93KCksXG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgaWQ6IHVzZXJJbmZvLmlkLFxuICAgICAgICAgICAgZW1haWw6IGxvZ2luUmVxdWVzdC5lbWFpbCxcbiAgICAgICAgICAgIGZ1bGxOYW1lOiB1c2VySW5mby5mdWxsTmFtZSxcbiAgICAgICAgICAgIHVzZXJUeXBlOiByZXNvbHZlZFR5cGUsXG4gICAgICAgICAgICBzdGF0dXM6ICdBQ1RJVkUnLFxuICAgICAgICAgICAgcGhvbmVOdW1iZXI6IHVzZXJJbmZvLnBob25lTnVtYmVyLFxuICAgICAgICAgICAgcHJvZmlsZVBpY3R1cmU6ICdhc3NldHMvYXZhdGFycy9kZWZhdWx0LWF2YXRhci5qcGcnLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICBsYXN0TG9naW5BdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgXG4gICAgICB0aGlzLmhhbmRsZVN1Y2Nlc3NmdWxMb2dpbihtb2NrUmVzcG9uc2UsIHJlbWVtYmVyTWUpO1xuICAgICAgcmV0dXJuIG9mKHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSAnSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZC4gUGxlYXNlIHRyeSBhZ2Fpbi4gKERlbW8gTW9kZSknO1xuICAgICAgdGhpcy51cGRhdGVBdXRoU3RhdGUoeyBcbiAgICAgICAgLi4udGhpcy5fYXV0aFN0YXRlLnZhbHVlLCBcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwgXG4gICAgICAgIGVycm9yOiBlcnJvck1lc3NhZ2UgXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0aHJvd0Vycm9yKCgpID0+IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTmF2aWdhdGUgdXNlciB0byBhcHByb3ByaWF0ZSBkYXNoYm9hcmQgYWZ0ZXIgc3VjY2Vzc2Z1bCBsb2dpblxuICAgKi9cbiAgICAgICAgICBwcml2YXRlIG5hdmlnYXRlQWZ0ZXJMb2dpbih1c2VyVHlwZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ05hdmlnYXRpbmcgZm9yIHVzZXIgdHlwZTonLCB1c2VyVHlwZSk7XG4gICAgICAgICAgc3dpdGNoICh1c2VyVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnSE9TUElUQUwnOlxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTmF2aWdhdGluZyB0byBhZG1pbiBkYXNoYm9hcmQnKTtcbiAgICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWycvYWRtaW4tZGFzaGJvYXJkJ10pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ0RPQ1RPUic6XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOYXZpZ2F0aW5nIHRvIGRvY3RvciBkYXNoYm9hcmQnKTtcbiAgICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWycvZGFzaGJvYXJkJ10pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ1BBVElFTlQnOlxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTmF2aWdhdGluZyB0byBwYXRpZW50IGRhc2hib2FyZCcpO1xuICAgICAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJy9wYXRpZW50LWRhc2hib2FyZCddKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRGVmYXVsdCBuYXZpZ2F0aW9uIHRvIGRhc2hib2FyZCcpO1xuICAgICAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJy9kYXNoYm9hcmQnXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgLyoqXG4gICAqIExvZ291dCB1c2VyIGFuZCBjbGVhciBhbGwgYXV0aGVudGljYXRpb24gZGF0YVxuICAgKi9cbiAgcHVibGljIGxvZ291dCgpOiB2b2lkIHtcbiAgICAvLyBDbGVhciBzdG9yZWQgZGF0YVxuICAgIHRoaXMuY2xlYXJTdG9yZWRBdXRoRGF0YSgpO1xuXG4gICAgLy8gVXBkYXRlIHN0YXRlXG4gICAgdGhpcy51cGRhdGVBdXRoU3RhdGUoe1xuICAgICAgY3VycmVudFVzZXI6IG51bGwsXG4gICAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgICAgZXJyb3I6IG51bGwsXG4gICAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZhbHNlXG4gICAgfSk7XG5cbiAgICAvLyBOYXZpZ2F0ZSB0byBsb2dpblxuICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnL2xvZ2luJ10pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZnJlc2ggYXV0aGVudGljYXRpb24gdG9rZW5cbiAgICovXG4gIHB1YmxpYyByZWZyZXNoVG9rZW4oKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gdGhpcy5nZXRTdG9yZWRSZWZyZXNoVG9rZW4oKTtcbiAgICBcbiAgICBpZiAoIXJlZnJlc2hUb2tlbikge1xuICAgICAgY29uc29sZS53YXJuKCdObyByZWZyZXNoIHRva2VuIGF2YWlsYWJsZSBmb3IgdG9rZW4gcmVmcmVzaCcpO1xuICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnQXR0ZW1wdGluZyB0byByZWZyZXNoIHRva2VuLi4uJyk7XG4gICAgY29uc3QgYXBpVXJsID0gdGhpcy5hcGlDb25maWcuZ2V0QXBpVXJsKCk7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8YW55PihgJHthcGlVcmx9L2FwaS9hdXRoL3JlZnJlc2hgLCB7IHJlZnJlc2hUb2tlbiB9KS5waXBlKFxuICAgICAgdGFwKChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdUb2tlbiByZWZyZXNoIHN1Y2Nlc3NmdWwnKTtcbiAgICAgICAgLy8gVXNlIHRoZSBzYW1lIGxvZ2luIGhhbmRsZXIgdG8gcHJvY2VzcyB0aGUgcmVmcmVzaCByZXNwb25zZVxuICAgICAgICB0aGlzLmhhbmRsZVN1Y2Nlc3NmdWxMb2dpbihyZXNwb25zZSwgdGhpcy5nZXRSZW1lbWJlck1lU3RhdHVzKCkpO1xuICAgICAgfSksXG4gICAgICBtYXAoKCkgPT4gdHJ1ZSksXG4gICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcignVG9rZW4gcmVmcmVzaCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgICAvLyBPbmx5IGxvZ291dCBpZiBpdCdzIGEgcmVhbCBhdXRoIGVycm9yLCBub3QgYSBuZXR3b3JrIGVycm9yXG4gICAgICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDQwMSB8fCBlcnJvci5zdGF0dXMgPT09IDQwMykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdSZWZyZXNoIHRva2VuIGludmFsaWQsIGxvZ2dpbmcgb3V0Jyk7XG4gICAgICAgICAgdGhpcy5sb2dvdXQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2YoZmFsc2UpO1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGN1cnJlbnQgdG9rZW4gaXMgdmFsaWRcbiAgICovXG4gIHB1YmxpYyBpc1Rva2VuVmFsaWQodG9rZW4/OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCB0b2tlblRvQ2hlY2sgPSB0b2tlbiB8fCB0aGlzLmdldFN0b3JlZFRva2VuKCk7XG4gICAgXG4gICAgaWYgKCF0b2tlblRvQ2hlY2spIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgZXhwaXJhdGlvbiA9IHRoaXMuZ2V0VG9rZW5FeHBpcmF0aW9uKHRva2VuVG9DaGVjayk7XG4gICAgICByZXR1cm4gRGF0ZS5ub3coKSA8IGV4cGlyYXRpb247XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0b2tlbiBleHBpcmF0aW9uIHRpbWVcbiAgICovXG4gIHByaXZhdGUgZ2V0VG9rZW5FeHBpcmF0aW9uKHRva2VuOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYXlsb2FkID0gSlNPTi5wYXJzZShhdG9iKHRva2VuLnNwbGl0KCcuJylbMV0pKTtcbiAgICAgIHJldHVybiBwYXlsb2FkLmV4cCAqIDEwMDA7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgdXNlciBpbmZvcm1hdGlvblxuICAgKi9cbiAgcHVibGljIGdldEN1cnJlbnRVc2VyKCk6IFVzZXJJbmZvIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuX2F1dGhTdGF0ZS52YWx1ZS5jdXJyZW50VXNlcj8udXNlciB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHVzZXIgdHlwZVxuICAgKi9cbiAgcHVibGljIGdldFVzZXJUeXBlKCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLl9hdXRoU3RhdGUudmFsdWUuY3VycmVudFVzZXI/LnVzZXIudXNlclR5cGUgfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB1c2VyIGhhcyBzcGVjaWZpYyBwZXJtaXNzaW9uXG4gICAqL1xuICBwdWJsaWMgaGFzUGVybWlzc2lvbihwZXJtaXNzaW9uOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCB1c2VyID0gdGhpcy5nZXRDdXJyZW50VXNlcigpO1xuICAgIHJldHVybiB1c2VyPy5wZXJtaXNzaW9ucz8uaW5jbHVkZXMocGVybWlzc2lvbikgfHwgZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdXNlciBpcyBvZiBzcGVjaWZpYyB0eXBlXG4gICAqL1xuICBwdWJsaWMgaXNVc2VyVHlwZSh1c2VyVHlwZTogVXNlclR5cGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5nZXRVc2VyVHlwZSgpID09PSB1c2VyVHlwZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB1c2VyIGlzIGhvc3BpdGFsIGFkbWluXG4gICAqL1xuICBwdWJsaWMgaXNIb3NwaXRhbEFkbWluKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzVXNlclR5cGUoVXNlclR5cGUuSE9TUElUQUwpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHVzZXIgaXMgZG9jdG9yXG4gICAqL1xuICBwdWJsaWMgaXNEb2N0b3IoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNVc2VyVHlwZShVc2VyVHlwZS5ET0NUT1IpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHVzZXIgaXMgcGF0aWVudFxuICAgKi9cbiAgcHVibGljIGlzUGF0aWVudCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc1VzZXJUeXBlKFVzZXJUeXBlLlBBVElFTlQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhdXRoZW50aWNhdGlvbiBzdGF0ZVxuICAgKi9cbiAgcHJpdmF0ZSB1cGRhdGVBdXRoU3RhdGUobmV3U3RhdGU6IFBhcnRpYWw8QXV0aFN0YXRlPik6IHZvaWQge1xuICAgIGNvbnN0IGN1cnJlbnRTdGF0ZSA9IHRoaXMuX2F1dGhTdGF0ZS52YWx1ZTtcbiAgICBjb25zdCB1cGRhdGVkU3RhdGUgPSB7IC4uLmN1cnJlbnRTdGF0ZSwgLi4ubmV3U3RhdGUgfTtcbiAgICBjb25zb2xlLmxvZygnVXBkYXRpbmcgYXV0aCBzdGF0ZTonLCB7IGN1cnJlbnRTdGF0ZSwgbmV3U3RhdGUsIHVwZGF0ZWRTdGF0ZSB9KTtcbiAgICB0aGlzLl9hdXRoU3RhdGUubmV4dCh1cGRhdGVkU3RhdGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIGF1dGhlbnRpY2F0aW9uIGRhdGEgaW4gc3RvcmFnZVxuICAgKi9cbiAgcHJpdmF0ZSBzdG9yZUF1dGhEYXRhKHRva2VuOiBzdHJpbmcsIHJlZnJlc2hUb2tlbjogc3RyaW5nIHwgdW5kZWZpbmVkLCB1c2VyOiBVc2VySW5mbywgcmVtZW1iZXJNZTogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgcmV0dXJuOyAvLyBTa2lwIGxvY2FsU3RvcmFnZS9zZXNzaW9uU3RvcmFnZSBvcGVyYXRpb25zIGR1cmluZyBTU1JcbiAgICB9XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIFZhbGlkYXRlIHRva2VuIGJlZm9yZSBzdG9yaW5nXG4gICAgICBpZiAoIXRva2VuIHx8IHRva2VuID09PSAnZHVtbXktdG9rZW4nKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgdG9rZW4gcHJvdmlkZWQgZm9yIHN0b3JhZ2UnKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHRva2VuJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIFByZXNlcnZlIGV4aXN0aW5nIHJlZnJlc2ggdG9rZW4gaWYgbmV3IG9uZSBpcyBub3QgcHJvdmlkZWQgKGZvciB0b2tlbiByZWZyZXNoIHNjZW5hcmlvcylcbiAgICAgIGNvbnN0IGV4aXN0aW5nUmVmcmVzaFRva2VuID0gdGhpcy5nZXRTdG9yZWRSZWZyZXNoVG9rZW4oKTtcbiAgICAgIGNvbnN0IHRva2VuVG9TdG9yZSA9IHJlZnJlc2hUb2tlbiB8fCBleGlzdGluZ1JlZnJlc2hUb2tlbjtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RvcmFnZSA9IHJlbWVtYmVyTWUgPyBsb2NhbFN0b3JhZ2UgOiBzZXNzaW9uU3RvcmFnZTtcbiAgICAgIFxuICAgICAgLy8gU3RvcmUgdG9rZW5cbiAgICAgIHN0b3JhZ2Uuc2V0SXRlbSh0aGlzLlRPS0VOX0tFWSwgdG9rZW4pO1xuICAgICAgXG4gICAgICAvLyBTdG9yZSByZWZyZXNoIHRva2VuIGlmIGF2YWlsYWJsZVxuICAgICAgaWYgKHRva2VuVG9TdG9yZSkge1xuICAgICAgICBzdG9yYWdlLnNldEl0ZW0odGhpcy5SRUZSRVNIX1RPS0VOX0tFWSwgdG9rZW5Ub1N0b3JlKTtcbiAgICAgICAgY29uc29sZS5sb2coJ1JlZnJlc2ggdG9rZW4gc3RvcmVkIGluJywgcmVtZW1iZXJNZSA/ICdsb2NhbFN0b3JhZ2UnIDogJ3Nlc3Npb25TdG9yYWdlJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBSZW1vdmUgcmVmcmVzaCB0b2tlbiBpZiBub3QgcHJvdmlkZWQgYW5kIG5vdCBwcmVzZXJ2aW5nIGV4aXN0aW5nXG4gICAgICAgIHN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLlJFRlJFU0hfVE9LRU5fS0VZKTtcbiAgICAgICAgY29uc29sZS53YXJuKCdObyByZWZyZXNoIHRva2VuIHByb3ZpZGVkIG9yIGZvdW5kJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFN0b3JlIHVzZXIgZGF0YVxuICAgICAgc3RvcmFnZS5zZXRJdGVtKHRoaXMuVVNFUl9LRVksIEpTT04uc3RyaW5naWZ5KHVzZXIpKTtcbiAgICAgIFxuICAgICAgLy8gU3RvcmUgcmVtZW1iZXIgbWUgcHJlZmVyZW5jZVxuICAgICAgc3RvcmFnZS5zZXRJdGVtKHRoaXMuUkVNRU1CRVJfTUVfS0VZLCByZW1lbWJlck1lID8gJ3RydWUnIDogJ2ZhbHNlJyk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCdBdXRoIGRhdGEgc3RvcmVkIHN1Y2Nlc3NmdWxseTonLCB7XG4gICAgICAgIGhhc1Rva2VuOiAhIXRva2VuLFxuICAgICAgICBoYXNSZWZyZXNoVG9rZW46ICEhdG9rZW5Ub1N0b3JlLFxuICAgICAgICByZW1lbWJlck1lLFxuICAgICAgICBzdG9yYWdlOiByZW1lbWJlck1lID8gJ2xvY2FsU3RvcmFnZScgOiAnc2Vzc2lvblN0b3JhZ2UnXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc3RvcmluZyBhdXRoIGRhdGE6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGFsbCBzdG9yZWQgYXV0aGVudGljYXRpb24gZGF0YVxuICAgKi9cbiAgcHJpdmF0ZSBjbGVhclN0b3JlZEF1dGhEYXRhKCk6IHZvaWQge1xuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgcmV0dXJuOyAvLyBTa2lwIGxvY2FsU3RvcmFnZS9zZXNzaW9uU3RvcmFnZSBvcGVyYXRpb25zIGR1cmluZyBTU1JcbiAgICB9XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMuVE9LRU5fS0VZKTtcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMuUkVGUkVTSF9UT0tFTl9LRVkpO1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5VU0VSX0tFWSk7XG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLlJFTUVNQkVSX01FX0tFWSk7XG4gICAgICBcbiAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5UT0tFTl9LRVkpO1xuICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLlJFRlJFU0hfVE9LRU5fS0VZKTtcbiAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5VU0VSX0tFWSk7XG4gICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMuUkVNRU1CRVJfTUVfS0VZKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2xlYXJpbmcgYXV0aCBkYXRhOicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHN0b3JlZCBhdXRoZW50aWNhdGlvbiB0b2tlblxuICAgKi9cbiAgcHVibGljIGdldFN0b3JlZFRva2VuKCk6IHN0cmluZyB8IG51bGwge1xuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgcmV0dXJuIG51bGw7IC8vIFJldHVybiBudWxsIGR1cmluZyBTU1JcbiAgICB9XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLlRPS0VOX0tFWSkgfHwgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh0aGlzLlRPS0VOX0tFWSk7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHN0b3JlZCByZWZyZXNoIHRva2VuXG4gICAqL1xuICBwdWJsaWMgZ2V0U3RvcmVkUmVmcmVzaFRva2VuKCk6IHN0cmluZyB8IG51bGwge1xuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgcmV0dXJuIG51bGw7IC8vIFJldHVybiBudWxsIGR1cmluZyBTU1JcbiAgICB9XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLlJFRlJFU0hfVE9LRU5fS0VZKSB8fCBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHRoaXMuUkVGUkVTSF9UT0tFTl9LRVkpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzdG9yZWQgdXNlciBkYXRhXG4gICAqL1xuICBwdWJsaWMgZ2V0U3RvcmVkVXNlcigpOiBVc2VySW5mbyB8IG51bGwge1xuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgcmV0dXJuIG51bGw7IC8vIFJldHVybiBudWxsIGR1cmluZyBTU1JcbiAgICB9XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5VU0VSX0tFWSkgfHwgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh0aGlzLlVTRVJfS0VZKTtcbiAgICAgIHJldHVybiB1c2VyRGF0YSA/IEpTT04ucGFyc2UodXNlckRhdGEpIDogbnVsbDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcmVtZW1iZXIgbWUgc3RhdHVzXG4gICAqL1xuICBwcml2YXRlIGdldFJlbWVtYmVyTWVTdGF0dXMoKTogYm9vbGVhbiB7XG4gICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtSWQpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7IC8vIFJldHVybiBmYWxzZSBkdXJpbmcgU1NSXG4gICAgfVxuICAgIFxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5SRU1FTUJFUl9NRV9LRVkpID09PSAndHJ1ZScgfHwgXG4gICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh0aGlzLlJFTUVNQkVSX01FX0tFWSkgPT09ICd0cnVlJztcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdXNlciBpcyBjdXJyZW50bHkgYXV0aGVudGljYXRlZCAoc3luY2hyb25vdXMgbWV0aG9kIGZvciBndWFyZHMpXG4gICAqL1xuICBwdWJsaWMgaXNBdXRoZW50aWNhdGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9hdXRoU3RhdGUudmFsdWUuaXNBdXRoZW50aWNhdGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhdXRoZW50aWNhdGlvbiBoZWFkZXJzIGZvciBIVFRQIHJlcXVlc3RzXG4gICAqL1xuICBwdWJsaWMgZ2V0QXV0aEhlYWRlcnMoKTogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSB7XG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldFN0b3JlZFRva2VuKCk7XG4gICAgcmV0dXJuIHRva2VuID8geyAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0b2tlbn1gIH0gOiB7fTtcbiAgfVxufSAiXX0=