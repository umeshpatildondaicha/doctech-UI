import { Injectable } from '@angular/core';
import { HttpHeaders, HttpParams } from '@angular/common/http';
import { throwError } from 'rxjs';
import { catchError, map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class HttpCallsService {
    constructor(http) {
        this.http = http;
        this.handleError = (error) => {
            const errorResponse = {
                message: error.message || 'An error occurred',
                status: error.status,
                statusText: error.statusText,
                error: error.error
            };
            return throwError(() => errorResponse);
        };
    }
    /**
     * Send GET request
     * @param url - The URL to send the GET request to
     * @param options - Optional HTTP options
     * @returns Observable with the response data
     */
    sendGet(url, options) {
        const httpOptions = this.prepareOptions(options);
        // Ensure observe is 'body' for simple methods unless explicitly set
        if (!options?.observe) {
            httpOptions.observe = 'body';
        }
        return this.http.get(url, httpOptions).pipe(catchError(this.handleError));
    }
    /**
     * Send POST request
     * @param url - The URL to send the POST request to
     * @param body - The request body
     * @param options - Optional HTTP options
     * @returns Observable with the response data
     */
    sendPost(url, body, options) {
        const httpOptions = this.prepareOptions(options);
        // Ensure observe is 'body' for simple methods unless explicitly set
        if (!options?.observe) {
            httpOptions.observe = 'body';
        }
        return this.http.post(url, body, httpOptions).pipe(catchError(this.handleError));
    }
    /**
     * Send PUT request
     * @param url - The URL to send the PUT request to
     * @param body - The request body
     * @param options - Optional HTTP options
     * @returns Observable with the response data
     */
    sendPut(url, body, options) {
        const httpOptions = this.prepareOptions(options);
        // Ensure observe is 'body' for simple methods unless explicitly set
        if (!options?.observe) {
            httpOptions.observe = 'body';
        }
        return this.http.put(url, body, httpOptions).pipe(catchError(this.handleError));
    }
    /**
     * Send PATCH request
     * @param url - The URL to send the PATCH request to
     * @param body - The request body
     * @param options - Optional HTTP options
     * @returns Observable with the response data
     */
    sendPatch(url, body, options) {
        const httpOptions = this.prepareOptions(options);
        // Ensure observe is 'body' for simple methods unless explicitly set
        if (!options?.observe) {
            httpOptions.observe = 'body';
        }
        return this.http.patch(url, body, httpOptions).pipe(catchError(this.handleError));
    }
    /**
     * Send DELETE request
     * @param url - The URL to send the DELETE request to
     * @param options - Optional HTTP options
     * @returns Observable with the response data
     */
    sendDelete(url, options) {
        const httpOptions = this.prepareOptions(options);
        // Ensure observe is 'body' for simple methods unless explicitly set
        if (!options?.observe) {
            httpOptions.observe = 'body';
        }
        return this.http.delete(url, httpOptions).pipe(catchError(this.handleError));
    }
    /**
     * Get full HTTP response (including headers, status, etc.)
     * @param url - The URL to send the GET request to
     * @param options - Optional HTTP options
     * @returns Observable with the full HTTP response
     */
    sendGetResponse(url, options) {
        const baseOptions = this.prepareOptions(options);
        const httpOptions = {
            ...baseOptions,
            observe: 'response'
        };
        return this.http.get(url, httpOptions).pipe(map((response) => ({
            data: response.body,
            status: response.status,
            statusText: response.statusText,
            headers: response.headers
        })), catchError(this.handleError));
    }
    /**
     * Post and get full HTTP response
     * @param url - The URL to send the POST request to
     * @param body - The request body
     * @param options - Optional HTTP options
     * @returns Observable with the full HTTP response
     */
    sendPostResponse(url, body, options) {
        const baseOptions = this.prepareOptions(options);
        const httpOptions = {
            ...baseOptions,
            observe: 'response'
        };
        return this.http.post(url, body, httpOptions).pipe(map((response) => ({
            data: response.body,
            status: response.status,
            statusText: response.statusText,
            headers: response.headers
        })), catchError(this.handleError));
    }
    prepareOptions(options) {
        const defaultOptions = {
            headers: new HttpHeaders({
                'Content-Type': 'application/json'
            }),
            observe: 'body',
            responseType: 'json'
        };
        if (options) {
            if (options.headers) {
                defaultOptions.headers = options.headers instanceof HttpHeaders
                    ? options.headers
                    : new HttpHeaders(options.headers);
            }
            if (options.params) {
                defaultOptions.params = options.params instanceof HttpParams
                    ? options.params
                    : new HttpParams({ fromObject: options.params });
            }
            if (options.observe) {
                defaultOptions.observe = options.observe;
            }
            if (options.reportProgress !== undefined) {
                defaultOptions.reportProgress = options.reportProgress;
            }
            if (options.responseType) {
                defaultOptions.responseType = options.responseType;
            }
            if (options.withCredentials !== undefined) {
                defaultOptions.withCredentials = options.withCredentials;
            }
        }
        return defaultOptions;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: HttpCallsService, deps: [{ token: i1.HttpClient }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: HttpCallsService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: HttpCallsService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: () => [{ type: i1.HttpClient }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC1jYWxscy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvY29tbW9uLWxpYnMvY29yZS9zcmMvbGliL3NlcnZpY2VzL2h0dHAtY2FsbHMuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxXQUFXLEVBQUUsVUFBVSxFQUFnQixNQUFNLHNCQUFzQixDQUFDO0FBQ3pGLE9BQU8sRUFBYyxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDOUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7O0FBTWpELE1BQU0sT0FBTyxnQkFBZ0I7SUFDM0IsWUFBb0IsSUFBZ0I7UUFBaEIsU0FBSSxHQUFKLElBQUksQ0FBWTtRQThLNUIsZ0JBQVcsR0FBRyxDQUFDLEtBQVUsRUFBcUIsRUFBRTtZQUN0RCxNQUFNLGFBQWEsR0FBb0I7Z0JBQ3JDLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTyxJQUFJLG1CQUFtQjtnQkFDN0MsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO2dCQUNwQixVQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVU7Z0JBQzVCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSzthQUNuQixDQUFDO1lBQ0YsT0FBTyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUFDO0lBdExxQyxDQUFDO0lBRXhDOzs7OztPQUtHO0lBQ0gsT0FBTyxDQUFVLEdBQVcsRUFBRSxPQUEyQjtRQUN2RCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2pELG9FQUFvRTtRQUNwRSxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDO1lBQ3RCLFdBQVcsQ0FBQyxP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VTttQkFBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwSGVhZGVycywgSHR0cFBhcmFtcywgSHR0cFJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSUh0dHBDYWxsc09wdGlvbnMsIElIdHRwQ2FsbHNSZXNwb25zZSwgSUh0dHBDYWxsc0Vycm9yIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9odHRwLWNhbGxzLmludGVyZmFjZSc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIEh0dHBDYWxsc1NlcnZpY2Uge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHt9XG5cbiAgLyoqXG4gICAqIFNlbmQgR0VUIHJlcXVlc3RcbiAgICogQHBhcmFtIHVybCAtIFRoZSBVUkwgdG8gc2VuZCB0aGUgR0VUIHJlcXVlc3QgdG9cbiAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBIVFRQIG9wdGlvbnNcbiAgICogQHJldHVybnMgT2JzZXJ2YWJsZSB3aXRoIHRoZSByZXNwb25zZSBkYXRhXG4gICAqL1xuICBzZW5kR2V0PFQgPSBhbnk+KHVybDogc3RyaW5nLCBvcHRpb25zPzogSUh0dHBDYWxsc09wdGlvbnMpOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICBjb25zdCBodHRwT3B0aW9ucyA9IHRoaXMucHJlcGFyZU9wdGlvbnMob3B0aW9ucyk7XG4gICAgLy8gRW5zdXJlIG9ic2VydmUgaXMgJ2JvZHknIGZvciBzaW1wbGUgbWV0aG9kcyB1bmxlc3MgZXhwbGljaXRseSBzZXRcbiAgICBpZiAoIW9wdGlvbnM/Lm9ic2VydmUpIHtcbiAgICAgIGh0dHBPcHRpb25zLm9ic2VydmUgPSAnYm9keSc7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFQ+KHVybCwgaHR0cE9wdGlvbnMpLnBpcGUoXG4gICAgICBjYXRjaEVycm9yKHRoaXMuaGFuZGxlRXJyb3IpXG4gICAgKSBhcyBPYnNlcnZhYmxlPFQ+O1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgUE9TVCByZXF1ZXN0XG4gICAqIEBwYXJhbSB1cmwgLSBUaGUgVVJMIHRvIHNlbmQgdGhlIFBPU1QgcmVxdWVzdCB0b1xuICAgKiBAcGFyYW0gYm9keSAtIFRoZSByZXF1ZXN0IGJvZHlcbiAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBIVFRQIG9wdGlvbnNcbiAgICogQHJldHVybnMgT2JzZXJ2YWJsZSB3aXRoIHRoZSByZXNwb25zZSBkYXRhXG4gICAqL1xuICBzZW5kUG9zdDxUID0gYW55Pih1cmw6IHN0cmluZywgYm9keTogYW55LCBvcHRpb25zPzogSUh0dHBDYWxsc09wdGlvbnMpOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICBjb25zdCBodHRwT3B0aW9ucyA9IHRoaXMucHJlcGFyZU9wdGlvbnMob3B0aW9ucyk7XG4gICAgLy8gRW5zdXJlIG9ic2VydmUgaXMgJ2JvZHknIGZvciBzaW1wbGUgbWV0aG9kcyB1bmxlc3MgZXhwbGljaXRseSBzZXRcbiAgICBpZiAoIW9wdGlvbnM/Lm9ic2VydmUpIHtcbiAgICAgIGh0dHBPcHRpb25zLm9ic2VydmUgPSAnYm9keSc7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxUPih1cmwsIGJvZHksIGh0dHBPcHRpb25zKS5waXBlKFxuICAgICAgY2F0Y2hFcnJvcih0aGlzLmhhbmRsZUVycm9yKVxuICAgICkgYXMgT2JzZXJ2YWJsZTxUPjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIFBVVCByZXF1ZXN0XG4gICAqIEBwYXJhbSB1cmwgLSBUaGUgVVJMIHRvIHNlbmQgdGhlIFBVVCByZXF1ZXN0IHRvXG4gICAqIEBwYXJhbSBib2R5IC0gVGhlIHJlcXVlc3QgYm9keVxuICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIEhUVFAgb3B0aW9uc1xuICAgKiBAcmV0dXJucyBPYnNlcnZhYmxlIHdpdGggdGhlIHJlc3BvbnNlIGRhdGFcbiAgICovXG4gIHNlbmRQdXQ8VCA9IGFueT4odXJsOiBzdHJpbmcsIGJvZHk6IGFueSwgb3B0aW9ucz86IElIdHRwQ2FsbHNPcHRpb25zKTogT2JzZXJ2YWJsZTxUPiB7XG4gICAgY29uc3QgaHR0cE9wdGlvbnMgPSB0aGlzLnByZXBhcmVPcHRpb25zKG9wdGlvbnMpO1xuICAgIC8vIEVuc3VyZSBvYnNlcnZlIGlzICdib2R5JyBmb3Igc2ltcGxlIG1ldGhvZHMgdW5sZXNzIGV4cGxpY2l0bHkgc2V0XG4gICAgaWYgKCFvcHRpb25zPy5vYnNlcnZlKSB7XG4gICAgICBodHRwT3B0aW9ucy5vYnNlcnZlID0gJ2JvZHknO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5odHRwLnB1dDxUPih1cmwsIGJvZHksIGh0dHBPcHRpb25zKS5waXBlKFxuICAgICAgY2F0Y2hFcnJvcih0aGlzLmhhbmRsZUVycm9yKVxuICAgICkgYXMgT2JzZXJ2YWJsZTxUPjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIFBBVENIIHJlcXVlc3RcbiAgICogQHBhcmFtIHVybCAtIFRoZSBVUkwgdG8gc2VuZCB0aGUgUEFUQ0ggcmVxdWVzdCB0b1xuICAgKiBAcGFyYW0gYm9keSAtIFRoZSByZXF1ZXN0IGJvZHlcbiAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBIVFRQIG9wdGlvbnNcbiAgICogQHJldHVybnMgT2JzZXJ2YWJsZSB3aXRoIHRoZSByZXNwb25zZSBkYXRhXG4gICAqL1xuICBzZW5kUGF0Y2g8VCA9IGFueT4odXJsOiBzdHJpbmcsIGJvZHk6IGFueSwgb3B0aW9ucz86IElIdHRwQ2FsbHNPcHRpb25zKTogT2JzZXJ2YWJsZTxUPiB7XG4gICAgY29uc3QgaHR0cE9wdGlvbnMgPSB0aGlzLnByZXBhcmVPcHRpb25zKG9wdGlvbnMpO1xuICAgIC8vIEVuc3VyZSBvYnNlcnZlIGlzICdib2R5JyBmb3Igc2ltcGxlIG1ldGhvZHMgdW5sZXNzIGV4cGxpY2l0bHkgc2V0XG4gICAgaWYgKCFvcHRpb25zPy5vYnNlcnZlKSB7XG4gICAgICBodHRwT3B0aW9ucy5vYnNlcnZlID0gJ2JvZHknO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5odHRwLnBhdGNoPFQ+KHVybCwgYm9keSwgaHR0cE9wdGlvbnMpLnBpcGUoXG4gICAgICBjYXRjaEVycm9yKHRoaXMuaGFuZGxlRXJyb3IpXG4gICAgKSBhcyBPYnNlcnZhYmxlPFQ+O1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgREVMRVRFIHJlcXVlc3RcbiAgICogQHBhcmFtIHVybCAtIFRoZSBVUkwgdG8gc2VuZCB0aGUgREVMRVRFIHJlcXVlc3QgdG9cbiAgICogQHBhcmFtIG9wdGlvbnMgLSBPcHRpb25hbCBIVFRQIG9wdGlvbnNcbiAgICogQHJldHVybnMgT2JzZXJ2YWJsZSB3aXRoIHRoZSByZXNwb25zZSBkYXRhXG4gICAqL1xuICBzZW5kRGVsZXRlPFQgPSBhbnk+KHVybDogc3RyaW5nLCBvcHRpb25zPzogSUh0dHBDYWxsc09wdGlvbnMpOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICBjb25zdCBodHRwT3B0aW9ucyA9IHRoaXMucHJlcGFyZU9wdGlvbnMob3B0aW9ucyk7XG4gICAgLy8gRW5zdXJlIG9ic2VydmUgaXMgJ2JvZHknIGZvciBzaW1wbGUgbWV0aG9kcyB1bmxlc3MgZXhwbGljaXRseSBzZXRcbiAgICBpZiAoIW9wdGlvbnM/Lm9ic2VydmUpIHtcbiAgICAgIGh0dHBPcHRpb25zLm9ic2VydmUgPSAnYm9keSc7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHAuZGVsZXRlPFQ+KHVybCwgaHR0cE9wdGlvbnMpLnBpcGUoXG4gICAgICBjYXRjaEVycm9yKHRoaXMuaGFuZGxlRXJyb3IpXG4gICAgKSBhcyBPYnNlcnZhYmxlPFQ+O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBmdWxsIEhUVFAgcmVzcG9uc2UgKGluY2x1ZGluZyBoZWFkZXJzLCBzdGF0dXMsIGV0Yy4pXG4gICAqIEBwYXJhbSB1cmwgLSBUaGUgVVJMIHRvIHNlbmQgdGhlIEdFVCByZXF1ZXN0IHRvXG4gICAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwgSFRUUCBvcHRpb25zXG4gICAqIEByZXR1cm5zIE9ic2VydmFibGUgd2l0aCB0aGUgZnVsbCBIVFRQIHJlc3BvbnNlXG4gICAqL1xuICBzZW5kR2V0UmVzcG9uc2U8VCA9IGFueT4odXJsOiBzdHJpbmcsIG9wdGlvbnM/OiBJSHR0cENhbGxzT3B0aW9ucyk6IE9ic2VydmFibGU8SUh0dHBDYWxsc1Jlc3BvbnNlPFQ+PiB7XG4gICAgY29uc3QgYmFzZU9wdGlvbnMgPSB0aGlzLnByZXBhcmVPcHRpb25zKG9wdGlvbnMpO1xuICAgIGNvbnN0IGh0dHBPcHRpb25zOiBhbnkgPSB7XG4gICAgICAuLi5iYXNlT3B0aW9ucyxcbiAgICAgIG9ic2VydmU6ICdyZXNwb25zZScgYXMgY29uc3RcbiAgICB9O1xuICAgIHJldHVybiAodGhpcy5odHRwLmdldDxUPih1cmwsIGh0dHBPcHRpb25zKSBhcyBPYnNlcnZhYmxlPEh0dHBSZXNwb25zZTxUPj4pLnBpcGUoXG4gICAgICBtYXAoKHJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8VD4pID0+ICh7XG4gICAgICAgIGRhdGE6IHJlc3BvbnNlLmJvZHkgYXMgVCxcbiAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXG4gICAgICAgIHN0YXR1c1RleHQ6IHJlc3BvbnNlLnN0YXR1c1RleHQsXG4gICAgICAgIGhlYWRlcnM6IHJlc3BvbnNlLmhlYWRlcnNcbiAgICAgIH0pKSxcbiAgICAgIGNhdGNoRXJyb3IodGhpcy5oYW5kbGVFcnJvcilcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFBvc3QgYW5kIGdldCBmdWxsIEhUVFAgcmVzcG9uc2VcbiAgICogQHBhcmFtIHVybCAtIFRoZSBVUkwgdG8gc2VuZCB0aGUgUE9TVCByZXF1ZXN0IHRvXG4gICAqIEBwYXJhbSBib2R5IC0gVGhlIHJlcXVlc3QgYm9keVxuICAgKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsIEhUVFAgb3B0aW9uc1xuICAgKiBAcmV0dXJucyBPYnNlcnZhYmxlIHdpdGggdGhlIGZ1bGwgSFRUUCByZXNwb25zZVxuICAgKi9cbiAgc2VuZFBvc3RSZXNwb25zZTxUID0gYW55Pih1cmw6IHN0cmluZywgYm9keTogYW55LCBvcHRpb25zPzogSUh0dHBDYWxsc09wdGlvbnMpOiBPYnNlcnZhYmxlPElIdHRwQ2FsbHNSZXNwb25zZTxUPj4ge1xuICAgIGNvbnN0IGJhc2VPcHRpb25zID0gdGhpcy5wcmVwYXJlT3B0aW9ucyhvcHRpb25zKTtcbiAgICBjb25zdCBodHRwT3B0aW9uczogYW55ID0ge1xuICAgICAgLi4uYmFzZU9wdGlvbnMsXG4gICAgICBvYnNlcnZlOiAncmVzcG9uc2UnIGFzIGNvbnN0XG4gICAgfTtcbiAgICByZXR1cm4gKHRoaXMuaHR0cC5wb3N0PFQ+KHVybCwgYm9keSwgaHR0cE9wdGlvbnMpIGFzIE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPFQ+PikucGlwZShcbiAgICAgIG1hcCgocmVzcG9uc2U6IEh0dHBSZXNwb25zZTxUPikgPT4gKHtcbiAgICAgICAgZGF0YTogcmVzcG9uc2UuYm9keSBhcyBULFxuICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgaGVhZGVyczogcmVzcG9uc2UuaGVhZGVyc1xuICAgICAgfSkpLFxuICAgICAgY2F0Y2hFcnJvcih0aGlzLmhhbmRsZUVycm9yKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHByZXBhcmVPcHRpb25zKG9wdGlvbnM/OiBJSHR0cENhbGxzT3B0aW9ucyk6IGFueSB7XG4gICAgY29uc3QgZGVmYXVsdE9wdGlvbnM6IGFueSA9IHtcbiAgICAgIGhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycyh7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgIH0pLFxuICAgICAgb2JzZXJ2ZTogJ2JvZHknLFxuICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbidcbiAgICB9O1xuXG4gICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgIGlmIChvcHRpb25zLmhlYWRlcnMpIHtcbiAgICAgICAgZGVmYXVsdE9wdGlvbnMuaGVhZGVycyA9IG9wdGlvbnMuaGVhZGVycyBpbnN0YW5jZW9mIEh0dHBIZWFkZXJzIFxuICAgICAgICAgID8gb3B0aW9ucy5oZWFkZXJzIFxuICAgICAgICAgIDogbmV3IEh0dHBIZWFkZXJzKG9wdGlvbnMuaGVhZGVycyk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5wYXJhbXMpIHtcbiAgICAgICAgZGVmYXVsdE9wdGlvbnMucGFyYW1zID0gb3B0aW9ucy5wYXJhbXMgaW5zdGFuY2VvZiBIdHRwUGFyYW1zXG4gICAgICAgICAgPyBvcHRpb25zLnBhcmFtc1xuICAgICAgICAgIDogbmV3IEh0dHBQYXJhbXMoeyBmcm9tT2JqZWN0OiBvcHRpb25zLnBhcmFtcyB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLm9ic2VydmUpIHtcbiAgICAgICAgZGVmYXVsdE9wdGlvbnMub2JzZXJ2ZSA9IG9wdGlvbnMub2JzZXJ2ZTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLnJlcG9ydFByb2dyZXNzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZGVmYXVsdE9wdGlvbnMucmVwb3J0UHJvZ3Jlc3MgPSBvcHRpb25zLnJlcG9ydFByb2dyZXNzO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMucmVzcG9uc2VUeXBlKSB7XG4gICAgICAgIGRlZmF1bHRPcHRpb25zLnJlc3BvbnNlVHlwZSA9IG9wdGlvbnMucmVzcG9uc2VUeXBlO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMud2l0aENyZWRlbnRpYWxzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZGVmYXVsdE9wdGlvbnMud2l0aENyZWRlbnRpYWxzID0gb3B0aW9ucy53aXRoQ3JlZGVudGlhbHM7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGRlZmF1bHRPcHRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVFcnJvciA9IChlcnJvcjogYW55KTogT2JzZXJ2YWJsZTxuZXZlcj4gPT4ge1xuICAgIGNvbnN0IGVycm9yUmVzcG9uc2U6IElIdHRwQ2FsbHNFcnJvciA9IHtcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0FuIGVycm9yIG9jY3VycmVkJyxcbiAgICAgIHN0YXR1czogZXJyb3Iuc3RhdHVzLFxuICAgICAgc3RhdHVzVGV4dDogZXJyb3Iuc3RhdHVzVGV4dCxcbiAgICAgIGVycm9yOiBlcnJvci5lcnJvclxuICAgIH07XG4gICAgcmV0dXJuIHRocm93RXJyb3IoKCkgPT4gZXJyb3JSZXNwb25zZSk7XG4gIH07XG59XG5cbiJdfQ==