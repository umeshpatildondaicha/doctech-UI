<app-page [breadcrumb]="breadcrumb" [isFooter]="false">
  <div page-body class="dashboard">
    <!-- Stats cards -->
    <section class="stats-row">
      <app-admin-stats-card [stats]="overviewStatsCards" [showTrends]="true"></app-admin-stats-card>
    </section>

    <!-- Main grid -->
    <div class="grid">
      <!-- Left column -->
      <div class="col">
        <!-- Revenue Analytics -->
        <app-card [title]="'Revenue Analytics'" [subtitle]="'Monthly View'" [divider]="true">
          <div appCardActions>
            <app-button [fontIcon]="'more_vert'" [color]="'accent'" class="card-menu-btn"></app-button>
          </div>
          @if (isBrowser) {
            <highcharts-chart [Highcharts]="Highcharts" [options]="revenueChartOptions" class="chart"></highcharts-chart>
          } @else {
            <div class="chart-empty">
              <app-icon [fontIcon]="'show_chart'" [size]="40"></app-icon>
              <span>Loading chart...</span>
            </div>
          }
        </app-card>

        <!-- Patient Flow -->
        <app-card [title]="'Weekly Patient Flow'" [subtitle]="'This Week'" [divider]="true">
          @if (isBrowser) {
            <highcharts-chart [Highcharts]="Highcharts" [options]="patientFlowChartOptions" class="chart"></highcharts-chart>
          } @else {
            <div class="chart-empty">
              <app-icon [fontIcon]="'bar_chart'" [size]="40"></app-icon>
              <span>Loading chart...</span>
            </div>
          }
        </app-card>

        <!-- Financial Summary -->
        <app-card [title]="'Financial Summary'" [divider]="true">
          <div appCardActions>
            <app-button [text]="'View Details'" [color]="'primary'" [appearance]="'flat'"></app-button>
          </div>
          <div class="fin-grid">
            @for (metric of financialMetrics; track metric.label) {
              <div class="fin-item">
                <div class="fin-head">
                  <span class="fin-label">{{ metric.label }}</span>
                  <span class="fin-trend" [class.neg]="metric.trend < 0">
                    <app-icon [fontIcon]="metric.trend >= 0 ? 'arrow_upward' : 'arrow_downward'" [size]="12"></app-icon>
                    {{ metric.trend > 0 ? '+' : '' }}{{ metric.trend }}%
                  </span>
                </div>
                <div class="fin-value" [style.color]="metric.color">
                  {{ metric.currency }}{{ formatCurrency(metric.value).replace('â‚¹', '') }}
                </div>
              </div>
            }
          </div>
        </app-card>
      </div>

      <!-- Right column -->
      <div class="col">
        <!-- Department Distribution -->
        <app-card [title]="'Department Distribution'" [divider]="true">
          @if (isBrowser) {
            <highcharts-chart [Highcharts]="Highcharts" [options]="departmentChartOptions" class="chart"></highcharts-chart>
          } @else {
            <div class="chart-empty">
              <app-icon [fontIcon]="'donut_small'" [size]="40"></app-icon>
              <span>Loading chart...</span>
            </div>
          }
        </app-card>

        <!-- Department Performance -->
        <app-card [title]="'Department Performance'" [divider]="true">
          <div appCardActions>
            <app-button [text]="'View All'" [color]="'primary'" [appearance]="'flat'"></app-button>
          </div>
          <div class="dept-list">
            @for (dept of departments; track dept.id) {
              <button type="button" class="dept-row" (click)="viewDepartmentDetails(dept)">
                <div class="dept-info">
                  <div class="dept-name">{{ dept.name }}</div>
                  <div class="dept-head">{{ dept.head }}</div>
                </div>
                <div class="dept-stats">
                  <span class="dept-stat"><strong>{{ dept.staff }}</strong> Staff</span>
                  <span class="dept-stat"><strong>{{ dept.patients }}</strong> Patients</span>
                  <span class="dept-stat"><strong>{{ dept.occupancy }}%</strong> Occ.</span>
                </div>
                <div class="dept-revenue">{{ formatCurrency(dept.revenue) }}</div>
                <div class="dept-status">
                  <span class="status-dot" [style.background]="getDepartmentStatusColor(dept.status)"></span>
                  {{ dept.status | titlecase }}
                </div>
              </button>
            }
          </div>
        </app-card>

        <!-- Recent Activities -->
        <app-card [title]="'Recent Activities'" [divider]="true">
          <div appCardActions>
            <app-button [text]="'View All'" [color]="'primary'" [appearance]="'flat'" (btnClick)="viewAllActivities()"></app-button>
          </div>
          <div class="act-list">
            @for (activity of recentActivities; track activity.id) {
              <div class="act-row">
                <div class="act-icon" [style.color]="getActivityColor(activity.priority)">
                  <app-icon [fontIcon]="getActivityIcon(activity.type)" [size]="16"></app-icon>
                </div>
                <div class="act-body">
                  <div class="act-title">{{ activity.title }}</div>
                  <div class="act-desc">{{ activity.description }}</div>
                  <div class="act-time">{{ activity.time }}</div>
                </div>
                <span class="act-dot" [class]="'p-' + activity.priority"></span>
              </div>
            }
          </div>
        </app-card>
      </div>
    </div>
  </div>
</app-page>
