<div class="diet-dashboard">

  <!-- Tabs Section -->
  <mat-tab-group 
    [selectedIndex]="selectedTabIndex"
    (selectedIndexChange)="onTabChange($event)"
    class="diet-tabs"
  >
    <!-- Diets Tab -->
    <mat-tab label="Diets">
      <div class="tab-content">
        <!-- Statistics Cards (screenshot-style) -->
        <div class="stats-row">
          <div class="mini-stat">
            <div class="mini-icon bg-blue">
              <mat-icon>restaurant_menu</mat-icon>
            </div>
            <div class="mini-text">
              <div class="mini-label">Total Diets</div>
              <div class="mini-value">{{ dietList.length }}</div>
            </div>
          </div>

          <div class="mini-stat">
            <div class="mini-icon bg-orange">
              <mat-icon>local_fire_department</mat-icon>
            </div>
            <div class="mini-text">
              <div class="mini-label">Avg Calories</div>
              <div class="mini-value">{{ avgCalories }}</div>
            </div>
          </div>

          <div class="mini-stat">
            <div class="mini-icon bg-green">
              <mat-icon>fitness_center</mat-icon>
            </div>
            <div class="mini-text">
              <div class="mini-label">Avg Protein</div>
              <div class="mini-value">{{ avgProtein }}</div>
            </div>
          </div>

          <div class="mini-stat">
            <div class="mini-icon bg-purple">
              <mat-icon>groups</mat-icon>
            </div>
            <div class="mini-text">
              <div class="mini-label">Patients on Diets</div>
              <div class="mini-value">{{ patientsOnDiets }}</div>
            </div>
          </div>
        </div>

        <!-- Filters Row (screenshot-style) -->
        <div class="filters-row">
          <mat-form-field appearance="outline" class="search-field">
            <mat-icon matPrefix>search</mat-icon>
            <input matInput [(ngModel)]="searchQuery" (input)="onSearchChange($event)" placeholder="Search Diet" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="select-field">
            <mat-select [(ngModel)]="selectedDietType" (selectionChange)="onDietTypeChange($event)" placeholder="Diet Type">
              <mat-option value="">Diet Type</mat-option>
              <mat-option value="mediterranean">Mediterranean</mat-option>
              <mat-option value="keto">Keto</mat-option>
              <mat-option value="vegan">Vegan</mat-option>
              <mat-option value="vegetarian">Vegetarian</mat-option>
              <mat-option value="paleo">Paleo</mat-option>
              <mat-option value="cardiac">Cardiac</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="select-field">
            <mat-select [(ngModel)]="selectedMealType" (selectionChange)="filterDiets()" placeholder="Meal Type">
              <mat-option *ngFor="let mt of mealTypes" [value]="mt.value">{{ mt.label }}</mat-option>
            </mat-select>
          </mat-form-field>

          <button class="clear-link" type="button" (click)="clearFilters()">Clear Filters</button>

          <button mat-raised-button color="primary" class="add-btn" (click)="onCreateDiet()">
            <mat-icon>add</mat-icon>
            Add Diet
          </button>
        </div>

        <!-- Diet Cards Grid -->
        <div class="cards-grid">
          <app-diet-card
            *ngFor="let diet of filteredDiets"
            [diet]="diet"
            [showActions]="true"
            [clickable]="true"
            (cardClick)="onViewDiet($event)"
            (viewClick)="onViewDiet($event)"
            (editClick)="onEditDiet($event)"
            (deleteClick)="onDeleteDiet($event)"
            (videoClick)="onVideoClick($event)"
            (pdfClick)="onPdfClick($event)"
          ></app-diet-card>
        </div>

        <!-- No Results -->
        <div class="no-results" *ngIf="filteredDiets.length === 0">
          <div class="no-results-card">
            <div class="no-results-content">
              <mat-icon class="no-results-icon">restaurant</mat-icon>
              <h3>No diets found</h3>
              <p>Try adjusting your search criteria or create a new diet.</p>
              <button mat-raised-button color="primary" (click)="onCreateDiet()">
                <mat-icon>add</mat-icon>
                Add Diet
              </button>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- Diet Plans Tab -->
    <mat-tab label="Diet Plans">
      <div class="tab-content">
        <!-- Statistics Cards for Diet Plans -->
        <div class="stats-row">
          <div class="mini-stat">
            <div class="mini-icon bg-blue">
              <mat-icon>calendar_today</mat-icon>
            </div>
            <div class="mini-text">
              <div class="mini-label">Total Plans</div>
              <div class="mini-value">{{ dietPlans.length }}</div>
            </div>
          </div>

          <div class="mini-stat">
            <div class="mini-icon bg-orange">
              <mat-icon>check_circle</mat-icon>
            </div>
            <div class="mini-text">
              <div class="mini-label">Active Plans</div>
              <div class="mini-value">{{ getActivePlansCount() }}</div>
            </div>
          </div>

          <div class="mini-stat">
            <div class="mini-icon bg-green">
              <mat-icon>date_range</mat-icon>
            </div>
            <div class="mini-text">
              <div class="mini-label">Weekly Plans</div>
              <div class="mini-value">{{ getWeeklyPlansCount() }}</div>
            </div>
          </div>

          <div class="mini-stat">
            <div class="mini-icon bg-purple">
              <mat-icon>bar_chart</mat-icon>
            </div>
            <div class="mini-text">
              <div class="mini-label">Avg Adherence</div>
              <div class="mini-value">{{ getAvgAdherence() }}%</div>
            </div>
          </div>
        </div>

        <!-- Diet Plans Filters (same bar style) -->
        <div class="filters-row">
          <mat-form-field appearance="outline" class="search-field">
            <mat-icon matPrefix>search</mat-icon>
            <input
              matInput
              [(ngModel)]="planSearchQuery"
              (input)="onPlanSearchChange($event)"
              placeholder="Search Diet plans"
            />
          </mat-form-field>

          <mat-form-field appearance="outline" class="select-field">
            <mat-select [(ngModel)]="selectedPlanType" (selectionChange)="onPlanTypeChange($event)">
              <mat-option value="">Plan Type</mat-option>
              <mat-option value="weekly">Weekly</mat-option>
              <mat-option value="monthly">Monthly</mat-option>
              <mat-option value="custom">Custom</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="select-field">
            <mat-select [(ngModel)]="selectedPlanStatus" (selectionChange)="onPlanStatusChange($event)">
              <mat-option value="">Plan Status</mat-option>
              <mat-option value="active">Active</mat-option>
              <mat-option value="inactive">Inactive</mat-option>
              <mat-option value="draft">Draft</mat-option>
            </mat-select>
          </mat-form-field>

          <button class="clear-link" type="button" (click)="clearPlanFilters()">Clear Filters</button>

          <button mat-raised-button color="primary" class="add-btn" (click)="onCreateDietPlan()">
            <mat-icon>add</mat-icon>
            Create Weekly Plan
          </button>
        </div>

        <!-- Diet Plans Content -->
        <div class="diet-plans-content">
          <div class="plans-grid" *ngIf="filteredDietPlans.length > 0; else noPlans">
            <app-diet-plan-card
              *ngFor="let plan of filteredDietPlans"
              [plan]="plan"
              [showActions]="true"
              [showFooter]="true"
              (cardClick)="onViewPlan($event)"
              (viewClick)="onViewPlan($event)"
              (editClick)="onEditPlan($event)"
              (deleteClick)="onDeletePlan($event)"
            ></app-diet-plan-card>
          </div>

          <ng-template #noPlans>
            <div class="no-results">
              <div class="no-results-card">
                <div class="no-results-content">
                  <mat-icon class="no-results-icon">calendar_today</mat-icon>
                  <h3>No diet plans found</h3>
                  <p>Create your first weekly diet plan to get started.</p>
                  <button mat-raised-button color="primary" (click)="onCreateDietPlan()">
                    <mat-icon>add</mat-icon>
                    Create Weekly Plan
                  </button>
                </div>
              </div>
            </div>
          </ng-template>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
