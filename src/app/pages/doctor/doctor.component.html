<div class="doctor-management-page">
  <!-- 1. Doctor Quick Actions Panel (Top Section) -->
  <div class="quick-actions-panel">
    <div class="actions-left">
      <app-button
        type="button"
        class="action-btn primary"
        [fontIcon]="'add'"
        [text]="'Add New Doctor'"
        [color]="'primary'"
        [appearance]="'raised'"
        (btnClick)="addNewDoctor()">
      </app-button>
    </div>
    <div class="actions-right">
      <app-button
        type="button"
        class="action-btn secondary"
        [fontIcon]="viewMode === 'table' ? 'view_module' : 'table_view'"
        [text]="viewMode === 'table' ? 'Cards' : 'Table'"
        [appearance]="'stroked'"
        (btnClick)="toggleViewMode()">
      </app-button>
    </div>
  </div>

  <!-- 2. Mini Dashboard/Stats Bar -->
  <section aria-label="Doctor overview">
    <app-admin-stats-card [stats]="overviewStatsCards" [showTrends]="false"></app-admin-stats-card>
  </section>

  <!-- 3. Search and Filters Section -->
  <div class="filters-section">
    <div class="search-box">
      <mat-icon>search</mat-icon>
      <input
        type="text"
        placeholder="Search by ID, Name, Phone, or Specialization..."
        [(ngModel)]="searchTerm"
        (input)="applyFilters()"
        >
      </div>

      <div class="filters">
        <mat-select
          placeholder="Specialization"
          multiple
          [(ngModel)]="selectedSpecializations"
          (selectionChange)="applyFilters()"
          >
          @for (spec of specializations; track spec) {
            <mat-option [value]="spec">
              {{ spec }}
            </mat-option>
          }
        </mat-select>

        <mat-select
          placeholder="Hospital"
          multiple
          [(ngModel)]="selectedHospitals"
          (selectionChange)="applyFilters()"
          >
          @for (hospital of hospitals; track hospital) {
            <mat-option [value]="hospital">
              {{ hospital }}
            </mat-option>
          }
        </mat-select>

        <mat-select
          placeholder="Status"
          multiple
          [(ngModel)]="selectedStatuses"
          (selectionChange)="applyFilters()"
          >
          @for (status of statuses; track status) {
            <mat-option [value]="status">
              {{ status }}
            </mat-option>
          }
        </mat-select>

        <mat-select
          placeholder="Availability"
          multiple
          [(ngModel)]="selectedAvailability"
          (selectionChange)="applyFilters()"
          >
          @for (availability of availabilityOptions; track availability) {
            <mat-option [value]="availability">
              {{ availability }}
            </mat-option>
          }
        </mat-select>

        <mat-select
          placeholder="Sort By"
          [(ngModel)]="sortBy"
          (selectionChange)="applyFilters()"
          >
          <mat-option value="name">Name</mat-option>
          <mat-option value="specialization">Specialization</mat-option>
          <mat-option value="hospital">Hospital</mat-option>
          <mat-option value="status">Status</mat-option>
          <mat-option value="joinedDate">Joined Date</mat-option>
        </mat-select>

        <app-button
          type="button"
          class="sort-btn"
          [fontIcon]="sortOrder === 'asc' ? 'arrow_upward' : 'arrow_downward'"
          [appearance]="'icon'"
          (btnClick)="sortOrder = sortOrder === 'asc' ? 'desc' : 'asc'; applyFilters()">
        </app-button>
      </div>
    </div>

    <!-- 4. Bulk Actions Bar -->
    @if (selectedDoctors.length > 0) {
      <div class="bulk-actions">
        <div class="bulk-info">
          <mat-checkbox
            [(ngModel)]="selectAll"
            (change)="onSelectAll()"
            >
            {{ selectedDoctors.length }} doctor(s) selected
          </mat-checkbox>
        </div>
        <div class="bulk-buttons">
          <app-button type="button" class="bulk-btn" [text]="'Edit Selected'" [appearance]="'stroked'"></app-button>
          <app-button type="button" class="bulk-btn danger" [text]="'Delete Selected'" [appearance]="'stroked'"></app-button>
          <app-button type="button" class="bulk-btn" [text]="'Export Selected'" [appearance]="'stroked'"></app-button>
        </div>
      </div>
    }

    <!-- 5. Doctor List Content -->
    <div class="doctors-content">
      <!-- Table View -->
      @if (viewMode === 'table') {
        <div class="table-view">
          <table class="doctors-table">
            <thead>
              <tr>
                <th>
                  <mat-checkbox
                    [(ngModel)]="selectAll"
                    (change)="onSelectAll()"
                  ></mat-checkbox>
                </th>
                <th>Doctor ID</th>
                <th>Profile</th>
                <th>Specialization</th>
                <th>Hospital</th>
                <th>Availability</th>
                <th>Status</th>
                <th>Contact</th>
                <th>Login Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (doctor of filteredDoctors; track doctor) {
                <tr [class.selected]="selectedDoctors.includes(doctor.id)">
                  <td>
                    <mat-checkbox
                      [checked]="selectedDoctors.includes(doctor.id)"
                      (change)="onDoctorSelect(doctor.id)"
                    ></mat-checkbox>
                  </td>
                  <td>{{ doctor.id }}</td>
                  <td class="profile-cell">
                    <img [src]="doctor.profilePic" [alt]="doctor.name" class="profile-pic">
                    <div class="profile-info">
                      <div class="name">{{ doctor.name }}</div>
                      <div class="experience">{{ doctor.experience }}</div>
                    </div>
                  </td>
                  <td>
                    <span class="specialization-tag">{{ doctor.specialization }}</span>
                  </td>
                  <td>{{ doctor.hospital }}</td>
                  <td>
                    <span class="availability-badge" [style.background-color]="getAvailabilityColor(doctor.availability)">
                      {{ doctor.availability }}
                    </span>
                  </td>
                  <td>
                    <span class="status-badge" [style.background-color]="getStatusColor(doctor.status)">
                      {{ doctor.status }}
                    </span>
                  </td>
                  <td class="contact-cell">
                    <div class="phone">{{ doctor.phone }}</div>
                    <div class="email">{{ doctor.email }}</div>
                  </td>
                  <td class="login-status">
                    <mat-icon [class.logged-in]="doctor.hasUserAccount" [class.never-logged]="!doctor.hasUserAccount">
                      {{ doctor.hasUserAccount ? 'lock' : 'lock_open' }}
                    </mat-icon>
                    <span class="login-text">{{ doctor.hasUserAccount ? 'Has Account' : 'No Login' }}</span>
                  </td>
                  <td class="actions-cell">
                    <button mat-icon-button [matMenuTriggerFor]="menu" class="action-menu-btn">
                      <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu">
                      <button mat-menu-item (click)="viewDoctor(doctor)">
                        <mat-icon>visibility</mat-icon>
                        <span>View</span>
                      </button>
                      <button mat-menu-item (click)="editDoctor(doctor)">
                        <mat-icon>edit</mat-icon>
                        <span>Edit</span>
                      </button>
                      <button mat-menu-item (click)="scheduleDoctor(doctor)">
                        <mat-icon>schedule</mat-icon>
                        <span>Schedule</span>
                      </button>
                      <button mat-menu-item (click)="toggleDoctorStatus(doctor)">
                        <mat-icon>{{ doctor.status === 'Active' ? 'block' : 'check_circle' }}</mat-icon>
                        <span>{{ doctor.status === 'Active' ? 'Deactivate' : 'Activate' }}</span>
                      </button>
                      <button mat-menu-item (click)="deleteDoctor(doctor)" class="danger">
                        <mat-icon>delete</mat-icon>
                        <span>Delete</span>
                      </button>
                    </mat-menu>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }

      <!-- Cards View -->
      @if (viewMode === 'cards') {
        <div class="cards-view">
          <div class="doctors-grid">
            @for (doctor of filteredDoctors; track doctor) {
              <div class="doctor-card" [class.selected]="selectedDoctors.includes(doctor.id)">
                <div class="card-header">
                  <mat-checkbox
                    [checked]="selectedDoctors.includes(doctor.id)"
                    (change)="onDoctorSelect(doctor.id)"
                  ></mat-checkbox>
                  <div class="availability-dot" [style.background-color]="getAvailabilityColor(doctor.availability)"></div>
                </div>
                <div class="card-body">
                  <img [src]="doctor.profilePic" [alt]="doctor.name" class="card-profile-pic">
                  <h3 class="doctor-name">{{ doctor.name }}</h3>
                  <p class="doctor-id">{{ doctor.id }}</p>
                  <div class="specialization">
                    <span class="spec-tag">{{ doctor.specialization }}</span>
                  </div>
                  <div class="hospital-info">
                    <mat-icon>location_on</mat-icon>
                    <span>{{ doctor.hospital }}</span>
                  </div>
                  <div class="status-info">
                    <span class="status-badge" [style.background-color]="getStatusColor(doctor.status)">
                      {{ doctor.status }}
                    </span>
                  </div>
                  <div class="contact-info">
                    <div class="phone">{{ doctor.phone }}</div>
                    <div class="email">{{ doctor.email }}</div>
                  </div>
                  <div class="tags">
                    @for (tag of doctor.tags; track tag) {
                      <mat-chip class="tag-chip">
                        {{ tag }}
                      </mat-chip>
                    }
                  </div>
                  <div class="login-indicator">
                    <mat-icon [class.logged-in]="doctor.hasUserAccount" [class.never-logged]="!doctor.hasUserAccount">
                      {{ doctor.hasUserAccount ? 'lock' : 'lock_open' }}
                    </mat-icon>
                    <span>{{ doctor.hasUserAccount ? 'Has Account' : 'No Login' }}</span>
                  </div>
                </div>
                <div class="card-actions">
                  <app-button
                    type="button"
                    class="card-btn"
                    [fontIcon]="'visibility'"
                    [appearance]="'icon'"
                    (btnClick)="viewDoctor(doctor)">
                  </app-button>
                  <app-button
                    type="button"
                    class="card-btn"
                    [fontIcon]="'edit'"
                    [appearance]="'icon'"
                    (btnClick)="editDoctor(doctor)">
                  </app-button>
                  <app-button
                    type="button"
                    class="card-btn"
                    [fontIcon]="'schedule'"
                    [appearance]="'icon'"
                    (btnClick)="scheduleDoctor(doctor)">
                  </app-button>
                  <app-button
                    type="button"
                    class="card-btn danger"
                    [fontIcon]="'delete'"
                    [appearance]="'icon'"
                    (btnClick)="deleteDoctor(doctor)">
                  </app-button>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Empty State -->
      @if (filteredDoctors.length === 0) {
        <div class="empty-state">
          <div class="empty-illustration">
            <mat-icon>medical_services</mat-icon>
          </div>
          <h3>No doctors found</h3>
          <p>No doctors match your current filters. Try adjusting your search criteria.</p>
          <app-button
            type="button"
            class="primary-btn"
            [fontIcon]="'add'"
            [text]="'Add First Doctor'"
            [color]="'primary'"
            [appearance]="'raised'"
            (btnClick)="addNewDoctor()">
          </app-button>
        </div>
      }
    </div>
  </div>
