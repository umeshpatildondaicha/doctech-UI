<div class="exercise-assignment-dialog">
  <div class="dialog-content">
    <div class="dialog-body">
      <!-- Left Section: Exercise Selection -->
      <div class="exercise-selection-section">
        <div class="selection-controls">
          <div class="browse-toolbar">
            <h3>Browse Exercises</h3>
          </div>

          <div class="search-inline">
            <mat-form-field appearance="outline" class="search-field small">
              <mat-label>Search</mat-label>
              <input matInput [(ngModel)]="searchQuery" [placeholder]="viewTab === 'exercises' ? 'Search exercises...' : 'Search exercise groups...'">
              <mat-icon matPrefix>search</mat-icon>
              @if (searchQuery) {
                <app-button
                  appearance="icon"
                  fontIcon="close"
                  [text]="''"
                  (btnClick)="searchQuery=''"
                  matSuffix>
                </app-button>
              }
            </mat-form-field>
          </div>

          <div class="browse-tabs" role="tablist" aria-label="Exercise selection tabs">
            <app-button
              type="button"
              class="tab-btn"
              [ngClass]="{'active': viewTab === 'exercises'}"
              (btnClick)="viewTab = 'exercises'"
              role="tab"
              [attr.aria-selected]="viewTab === 'exercises'"
              appearance="basic"
              [text]="'Diet Exercises'">
              <mat-icon>fitness_center</mat-icon>
              
              @if (getFilteredExercises()?.length) {
                <span class="tab-count">{{ getFilteredExercises().length }}</span>
              }
            </app-button>
            <app-button
              type="button"
              class="tab-btn"
              [ngClass]="{'active': viewTab === 'groups'}"
              (btnClick)="viewTab = 'groups'"
              role="tab"
              [attr.aria-selected]="viewTab === 'groups'"
              appearance="basic"
              [text]="'Exercise Groups'">
              <mat-icon>group_work</mat-icon>
        
              @if (getFilteredGroups()?.length) {
                <span class="tab-count">{{ getFilteredGroups().length }}</span>
              }
            </app-button>
          </div>
        </div>

        <!-- Exercises Tab -->
        @if (viewTab === 'exercises') {
          <div class="exercises-list">
            @for (exercise of getFilteredExercises(); track exercise) {
              <div
                class="exercise-item"
                [class.selected]="isExerciseSelected(exercise)"
                (click)="toggleExerciseSelection(exercise)"
                (keydown.enter)="toggleExerciseSelection(exercise)"
                tabindex="0"
                role="button"
                [attr.aria-label]="'Select ' + exercise.name">
                <div class="exercise-item-info">
                  <h4 class="exercise-item-name">{{ exercise.name }}</h4>
                  <p class="exercise-item-meta">{{ exercise.category }} • {{ exercise.difficulty }} • {{ getSetsDisplay(exercise) }}</p>
                </div>
                <div class="exercise-item-actions">
                  <app-button
                    appearance="icon"
                    fontIcon="visibility"
                    class="view-btn"
                    [text]="''"
                    (btnClick)="viewExercise(exercise, $event)"
                    matTooltip="View exercise details">
                  </app-button>
                  @if (isExerciseSelected(exercise)) {
                    <mat-icon
                      class="check-icon">
                      check_circle
                    </mat-icon>
                  }
                  @if (!isExerciseSelected(exercise)) {
                    <app-button
                      appearance="icon"
                      fontIcon="add"
                      class="add-btn"
                      [text]="''"
                      (btnClick)="toggleExerciseSelection(exercise); $event.stopPropagation()"
                      matTooltip="Add exercise">
                    </app-button>
                  }
                </div>
              </div>
            }
          </div>
        }

        <!-- Exercise Groups Tab -->
        @if (viewTab === 'groups') {
          <div class="exercise-groups-list">
            @for (group of getFilteredGroups(); track group) {
              <div
                class="exercise-group-item"
                [class.selected]="isGroupSelected(group)"
                (click)="selectGroup(group)"
                (keydown.enter)="selectGroup(group)"
                tabindex="0"
                role="button"
                [attr.aria-label]="'Select ' + group.groupName">
                <div class="group-info">
                  <h4 class="group-name">{{ group.groupName }}</h4>
                  <p class="group-meta">{{ group.exercises.length }} exercises • {{ group.category || 'N/A' }} • {{ group.difficulty || 'N/A' }}</p>
                </div>
                <div class="group-actions">
                  <app-button
                    appearance="icon"
                    fontIcon="visibility"
                    class="view-btn"
                    [text]="''"
                    (btnClick)="viewGroup(group, $event)"
                    matTooltip="View group details">
                  </app-button>
                  @if (isGroupSelected(group)) {
                    <mat-icon
                      class="check-icon">
                      check_circle
                    </mat-icon>
                  }
                  @if (!isGroupSelected(group)) {
                    <app-button
                      appearance="icon"
                      fontIcon="add"
                      class="add-btn"
                      [text]="''"
                      (btnClick)="addGroup(group, $event)"
                      matTooltip="Add group">
                    </app-button>
                  }
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Right Section: Assignment Summary -->
      <div class="assignment-summary-section">
        <h3>Assignment Summary ({{ getSelectedExercisesCount() }})</h3>

        @if (selectedExercises.length > 0) {
          <div class="summary-content">
            <!-- Selected Exercises List -->
            <div class="selected-exercises-list">
              @for (exercise of selectedExercises; track exercise; let i = $index) {
                <div
                  class="selected-exercise-item">
                  <div class="exercise-info">
                    <h5 class="exercise-name">{{ exercise.name }}</h5>
                    <p class="exercise-meta">{{ exercise.category }} • {{ exercise.difficulty }}</p>
                    <div class="sets-info-display">
                      <span class="sets-badge" [class.no-sets]="!exercise.sets || exercise.sets.length === 0">
                        <mat-icon class="sets-icon">repeat</mat-icon>
                        <span class="sets-text">{{ getSetsDisplay(exercise) }}</span>
                      </span>
                      <app-button
                        appearance="icon"
                        fontIcon="edit"
                        class="edit-sets-btn"
                        [text]="'Edit Sets'"
                        (btnClick)="editExerciseSets(exercise, i)"
                        matTooltip="Edit Sets">
                      </app-button>
                    </div>
                  </div>
                  <app-button
                    appearance="icon"
                    fontIcon="delete"
                    class="remove-btn"
                    [text]="'Remove'"
                    (btnClick)="removeExercise(i)">
                  </app-button>
                </div>
              }
            </div>
          </div>
        }

        <!-- Empty State -->
        @if (selectedExercises.length === 0) {
          <div class="empty-state">
            <mat-icon class="empty-icon">fitness_center</mat-icon>
            <p>No exercises selected. Choose exercises from the list to add them.</p>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Date Fields -->
  <div class="dialog-date-fields">
    <mat-form-field appearance="outline" class="date-picker">
      <mat-label>Start Date</mat-label>
      <input
        matInput
        [matDatepicker]="pickerStart"
        [(ngModel)]="assignmentDate">
        <mat-datepicker-toggle matSuffix [for]="pickerStart"></mat-datepicker-toggle>
        <mat-datepicker #pickerStart></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="date-picker">
        <mat-label>Till Date</mat-label>
        <input
          matInput
          [matDatepicker]="pickerEnd"
          [(ngModel)]="endDate"
          [min]="assignmentDate">
          <mat-datepicker-toggle matSuffix [for]="pickerEnd"></mat-datepicker-toggle>
          <mat-datepicker #pickerEnd></mat-datepicker>
        </mat-form-field>
      </div>
    </div>
