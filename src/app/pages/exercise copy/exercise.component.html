<div class="exercise-dashboard">

  <!-- Tabs Section -->
  <mat-tab-group 
    [selectedIndex]="selectedTabIndex"
    (selectedIndexChange)="onTabChange($event)"
    class="exercise-tabs"
  >
    <!-- Individual Tab (screenshot-style label) -->
    <mat-tab label="Individual">
      <div class="tab-content">
        <!-- Statistics Cards (screenshot-style) -->
        <div class="stats-row">
          <div class="mini-stat">
            <div class="mini-icon bg-blue"><mat-icon>people</mat-icon></div>
            <div class="mini-text">
              <div class="mini-label">Total Patients</div>
              <div class="mini-value">124</div>
            </div>
          </div>
          <div class="mini-stat">
            <div class="mini-icon bg-orange"><mat-icon>assignment</mat-icon></div>
            <div class="mini-text">
              <div class="mini-label">Active Exercise Plans</div>
              <div class="mini-value">98</div>
            </div>
          </div>
          <div class="mini-stat">
            <div class="mini-icon bg-green"><mat-icon>verified</mat-icon></div>
            <div class="mini-text">
              <div class="mini-label">Overall Completion Rate</div>
              <div class="mini-value">74%</div>
            </div>
          </div>
          <div class="mini-stat">
            <div class="mini-icon bg-red"><mat-icon>report</mat-icon></div>
            <div class="mini-text">
              <div class="mini-label">Missed Exercises Today</div>
              <div class="mini-value">18</div>
            </div>
          </div>
        </div>

        <!-- Filters Row (screenshot-style) -->
        <div class="filters-row">
          <mat-form-field appearance="outline" class="search-field">
            <mat-icon matPrefix>search</mat-icon>
            <input matInput [(ngModel)]="searchQuery" placeholder="Search Exercise" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="select-field">
            <mat-select [(ngModel)]="selectedCategory" (selectionChange)="onCategoryChange($event)">
              <mat-option value="all">All Categories</mat-option>
              <mat-option *ngFor="let category of categories" [value]="category.value">{{ category.label }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="select-field">
            <mat-select [(ngModel)]="selectedDifficulty" (selectionChange)="onDifficultyChange($event)">
              <mat-option value="all">Any Level</mat-option>
              <mat-option *ngFor="let difficulty of difficulties" [value]="difficulty.value">{{ difficulty.label }}</mat-option>
            </mat-select>
          </mat-form-field>

          <button class="clear-link" type="button" (click)="clearFilters()">Clear Filters</button>

          <button mat-raised-button color="primary" class="add-btn" (click)="onAddExercise()">
            <mat-icon>add</mat-icon>
            Add Exercise
          </button>
        </div>

        <!-- Exercise Cards Grid -->
        <div class="cards-grid" *ngIf="getFilteredExercises().length > 0; else noResults">
          <app-exercise-card 
            *ngFor="let exercise of getFilteredExercises()"
            [exercise]="exercise"
            [showActions]="true"
            [clickable]="true"
            (cardClick)="onViewExercise({data: exercise})"
            (viewClick)="onViewExercise({data: exercise})"
            (editClick)="onEditExercise({data: exercise})"
            (deleteClick)="onDeleteExercise({data: exercise})">
          </app-exercise-card>
        </div>

        <!-- Table View -->
        <!-- (Table view removed for screenshot parity) -->

        <!-- No Results Template -->
        <ng-template #noResults>
          <div class="no-results">
            <mat-card class="no-results-card">
              <div class="no-results-content">
                <mat-icon class="no-results-icon">search_off</mat-icon>
                <h3>No exercises found</h3>
                <p>Try adjusting your search criteria or filters</p>
                <button mat-raised-button color="primary" (click)="clearFilters()">
                  Clear Filters
                </button>
              </div>
            </mat-card>
          </div>
        </ng-template>
      </div>
    </mat-tab>

    <!-- Exercise Groups Tab -->
    <mat-tab label="Groups">
      <div class="tab-content">
        <!-- Statistics Cards -->
        <div class="stats-cards">
          <mat-card class="stat-card total-card">
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>group_work</mat-icon>
              </div>
              <div class="stat-info">
                <div class="stat-number">{{ exerciseGroups.length }}</div>
                <div class="stat-label">Total Groups</div>
              </div>
            </div>
          </mat-card>

          <mat-card class="stat-card exercises-card">
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>fitness_center</mat-icon>
              </div>
              <div class="stat-info">
                <div class="stat-number">{{ getTotalExercisesInGroups() }}</div>
                <div class="stat-label">Total Exercises</div>
              </div>
            </div>
          </mat-card>

          <mat-card class="stat-card categories-card">
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>category</mat-icon>
              </div>
              <div class="stat-info">
                <div class="stat-number">{{ getGroupCategoriesCount() }}</div>
                <div class="stat-label">Categories</div>
              </div>
            </div>
          </mat-card>
        </div>

        <!-- Groups Filters (same bar style) -->
        <div class="filters-row">
          <mat-form-field appearance="outline" class="search-field">
            <mat-icon matPrefix>search</mat-icon>
            <input matInput [(ngModel)]="groupSearchQuery" placeholder="Search group exercise" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="select-field">
            <mat-select [(ngModel)]="selectedGroupCategory" (selectionChange)="onGroupCategoryChange()">
              <mat-option value="">All Categories</mat-option>
              <mat-option *ngFor="let category of groupCategories" [value]="category.value">
                {{ category.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="select-field">
            <mat-select [(ngModel)]="selectedGroupDifficulty" (selectionChange)="onGroupDifficultyChange()">
              <mat-option value="">Any Level</mat-option>
              <mat-option *ngFor="let difficulty of groupDifficulties" [value]="difficulty.value">
                {{ difficulty.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <button class="clear-link" type="button" (click)="clearGroupFilters()">Clear Filters</button>

          <button mat-raised-button color="primary" class="add-btn" (click)="onAddExerciseGroup()">
            <mat-icon>add</mat-icon>
            Add Group
          </button>
        </div>

        <!-- Groups Cards -->
        <div class="groups-cards">
          <div class="cards-grid" *ngIf="getFilteredGroups().length > 0; else noGroups">
            <mat-card class="group-card" *ngFor="let group of getFilteredGroups()">
              <!-- Group Header -->
              <div class="card-header">
                <div class="group-info">
                  <h3 class="group-name">{{ group.groupName }}</h3>
                  <div class="group-meta">
                    <span class="category-badge">{{ group.category || 'Uncategorized' }}</span>
                    <span class="difficulty-badge" *ngIf="group.difficulty" [class]="'difficulty-' + group.difficulty.toLowerCase()">
                      {{ group.difficulty }}
                    </span>
                  </div>
                </div>
                <div class="group-actions">
                  <button mat-icon-button (click)="onViewGroup({data: group})" matTooltip="View group details">
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button mat-icon-button (click)="onEditGroup({data: group})" matTooltip="Edit group">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button mat-icon-button color="warn" (click)="onDeleteGroup({data: group})" matTooltip="Delete group">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>

              <!-- Group Description -->
              <div class="group-description" *ngIf="group.description">
                <p>{{ group.description }}</p>
              </div>

              <!-- Exercises Preview -->
              <div class="exercises-preview">
                <h4 class="subsection-title">Exercises ({{ group.exercises.length }})</h4>
                <div class="exercises-scroll">
                  <div class="exercise-cards">
                    <div class="exercise-mini-card" *ngFor="let exercise of group.exercises">
                      <!-- Media Section -->
                      <div class="media-section">
                        <div class="media-placeholder" *ngIf="!exercise.media || exercise.media.length === 0">
                          <mat-icon>fitness_center</mat-icon>
                        </div>
                        <img *ngIf="exercise.media && exercise.media.length > 0" 
                             [src]="exercise.media[0]" 
                             [alt]="exercise.name + ' exercise'"
                             class="exercise-media">
                        <div class="media-overlay"></div>
                      </div>
                      
                      <!-- Content Section -->
                      <div class="mini-card-content">
                        <div class="exercise-info">
                          <span class="exercise-name">{{ exercise.name }}</span>
                          <span class="exercise-category">{{ exercise.category }}</span>
                        </div>
                        <div class="exercise-meta">
                          <span class="difficulty-badge" [class]="'difficulty-' + exercise.difficulty.toLowerCase()">
                            {{ exercise.difficulty }}
                          </span>
                          <mat-icon class="exercise-icon">fitness_center</mat-icon>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Group Stats -->
              <div class="group-stats">
                <div class="stat-item">
                  <mat-icon>fitness_center</mat-icon>
                  <span>{{ group.exercises.length }} exercises</span>
                </div>
                <div class="stat-item">
                  <mat-icon>schedule</mat-icon>
                  <span>Created {{ getTimeAgo(group.createdAt) }}</span>
                </div>
              </div>
            </mat-card>
          </div>
        </div>

        <!-- No Groups Template -->
        <ng-template #noGroups>
          <div class="no-groups">
            <mat-card class="no-groups-card">
              <div class="no-groups-content">
                <mat-icon class="no-groups-icon">group_work</mat-icon>
                <h3>No exercise groups found</h3>
                <p>Create your first exercise group to get started</p>
                <button mat-raised-button color="primary" (click)="onAddExerciseGroup()">
                  <mat-icon>add</mat-icon>
                  Create First Group
                </button>
              </div>
            </mat-card>
          </div>
        </ng-template>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
