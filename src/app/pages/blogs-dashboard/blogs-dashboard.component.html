<app-page>
  <div class="blogs-dashboard" page-body>
    <!-- Overview -->
    <section class="kpi-grid" aria-label="Blog overview">
      <button type="button" class="kpi" (click)="setStatusFilter('ALL')">
        <div class="kpi-ic kpi-ic--primary">
          <app-icon [fontIcon]="'rss_feed'" [size]="20"></app-icon>
        </div>
        <div class="kpi-body">
          <div class="kpi-k">Total posts</div>
          <div class="kpi-v">{{ stats().total }}</div>
        </div>
      </button>

      <button type="button" class="kpi" (click)="setStatusFilter('PUBLISHED')">
        <div class="kpi-ic kpi-ic--success">
          <app-icon [fontIcon]="'public'" [size]="20"></app-icon>
        </div>
        <div class="kpi-body">
          <div class="kpi-k">Published</div>
          <div class="kpi-v">{{ stats().published }}</div>
        </div>
      </button>

      <button type="button" class="kpi" (click)="setStatusFilter('DRAFT')">
        <div class="kpi-ic kpi-ic--warning">
          <app-icon [fontIcon]="'edit_note'" [size]="20"></app-icon>
        </div>
        <div class="kpi-body">
          <div class="kpi-k">Drafts</div>
          <div class="kpi-v">{{ stats().drafts }}</div>
        </div>
      </button>

      <button type="button" class="kpi" (click)="setStatusFilter('SCHEDULED')">
        <div class="kpi-ic kpi-ic--info">
          <app-icon [fontIcon]="'schedule'" [size]="20"></app-icon>
        </div>
        <div class="kpi-body">
          <div class="kpi-k">Scheduled</div>
          <div class="kpi-v">{{ stats().scheduled }}</div>
        </div>
      </button>
    </section>

    <!-- List -->
    <section class="card">
      <app-entity-toolbar
        title="Posts"
        [showCounts]="true"
        [currentCount]="filteredPosts().length"
        [totalCount]="posts().length"
        newLabel="New post"
        [showRefresh]="true"
        [showFilter]="true"
        (newClick)="createPost()"
        (search)="onSearch($event)"
        (refreshClick)="onRefresh()"
        (filterClick)="toggleFilterPanel()">
      </app-entity-toolbar>

      <app-divider></app-divider>

      <div class="card-body">
        @if (filteredPosts().length === 0) {
          <div class="empty">
            <div class="empty-ic">
              <app-icon [fontIcon]="'description'" [size]="26"></app-icon>
            </div>
            <h3>No posts found</h3>
            <p class="muted">Try a different search/filter, or create a new post.</p>
            <app-button text="Create a new post" color="primary" appearance="raised" (btnClick)="createPost()"></app-button>
          </div>
        } @else {
          <div class="grid" aria-label="Blog posts">
            @for (p of filteredPosts(); track p.id) {
              <article class="blog-card">
                <button type="button" class="cover" (click)="editPost(p)" aria-label="Edit {{ p.title }}">
                  @if (p.coverImageUrl) {
                    <img class="cover-img" [src]="p.coverImageUrl" alt="" />
                  } @else {
                    <div class="cover-ph">
                      <app-icon [fontIcon]="'image'" [size]="24"></app-icon>
                    </div>
                  }
                </button>

                <div class="body">
                  <div class="title-row">
                    <h3 class="title" [title]="p.title">{{ p.title }}</h3>
                    @if (p.status === 'PUBLISHED') {
                      <span class="verified" aria-label="Published">âœ“</span>
                    }
                  </div>
                  <p class="excerpt">{{ excerpt(p.content) }}</p>

                  <div class="footer">
                    <span class="stat">
                      <app-icon [fontIcon]="'visibility'" [size]="14"></app-icon>
                      {{ p.views | number }}
                    </span>
                    <span class="stat">
                      <app-icon [fontIcon]="'favorite'" [size]="14"></app-icon>
                      {{ p.likes | number }}
                    </span>
                    <button type="button" class="action-btn" (click)="editPost(p)">Edit +</button>
                  </div>
                </div>
              </article>
            }
          </div>
        }
      </div>
    </section>
  </div>
</app-page>

