<app-page [breadcrumb]="breadcrumb" [isFooter]="false">
  <div page-body class="plans-page">

    <!-- Hero Stats Bar -->
    <div class="stats-bar">
      <div class="stat-pill">
        <mat-icon>payments</mat-icon>
        <div class="sp-info">
          <span class="sp-val">{{ plans.length }}</span>
          <span class="sp-lbl">Plans</span>
        </div>
      </div>
      <div class="stat-pill">
        <mat-icon>check_circle</mat-icon>
        <div class="sp-info">
          <span class="sp-val">{{ activePlans() }}</span>
          <span class="sp-lbl">Active</span>
        </div>
      </div>
      <div class="stat-pill">
        <mat-icon>groups</mat-icon>
        <div class="sp-info">
          <span class="sp-val">{{ totalSubscribers() }}</span>
          <span class="sp-lbl">Subscribers</span>
        </div>
      </div>
      <div class="stat-pill">
        <mat-icon>currency_rupee</mat-icon>
        <div class="sp-info">
          <span class="sp-val">{{ formatPrice(totalRevenue()) }}</span>
          <span class="sp-lbl">Est. Revenue</span>
        </div>
      </div>
    </div>

    <!-- Billing Cycle Toggle + Add -->
    <div class="section-head">
      <div class="sh-left">
        <h2 class="section-title">Pricing Plans</h2>
        <p class="section-sub">Choose the perfect plan for your patients</p>
      </div>
      <div class="sh-right">
        <div class="cycle-toggle">
          <button type="button" class="ct-btn" [class.active]="billingCycle() === 'monthly'" (click)="billingCycle.set('monthly')">Monthly</button>
          <button type="button" class="ct-btn" [class.active]="billingCycle() === 'yearly'" (click)="billingCycle.set('yearly')">
            Yearly
            <span class="ct-save">Save 17%</span>
          </button>
        </div>
        <button type="button" class="add-plan-btn" (click)="addNewPlan()">
          <mat-icon>add</mat-icon>
          Add Plan
        </button>
      </div>
    </div>

    <!-- Plans Grid -->
    <div class="plans-grid">
      @for (plan of plans; track plan.id) {
        <div class="plan-card" [class.popular]="plan.popular" [class.inactive]="plan.status === 'inactive'">
          <!-- Popular badge -->
          @if (plan.badge) {
            <div class="plan-badge" [style.background]="plan.gradient">{{ plan.badge }}</div>
          }

          <!-- Card header -->
          <div class="pc-head">
            <div class="pc-icon" [style.background]="plan.gradient">
              <mat-icon>{{ plan.icon }}</mat-icon>
            </div>
            <div class="pc-name">{{ plan.name }}</div>
            <div class="pc-tagline">{{ plan.tagline }}</div>
          </div>

          <!-- Price -->
          <div class="pc-price">
            <span class="pc-currency">{{ plan.currency }}</span>
            <span class="pc-amount">{{ getPrice(plan) }}</span>
            <span class="pc-period">/{{ billingCycle() === 'monthly' ? 'mo' : 'yr' }}</span>
          </div>
          @if (billingCycle() === 'yearly') {
            <div class="pc-savings">You save {{ plan.currency }}{{ getSavings(plan) }}/year</div>
          }

          <!-- Subscribers -->
          <div class="pc-subs">
            <mat-icon>people</mat-icon>
            <span>{{ plan.subscribers }} active subscribers</span>
          </div>

          <!-- Features -->
          <div class="pc-features">
            @for (feat of plan.features; track feat.name) {
              <div class="pc-feat" [class.disabled]="!feat.included">
                <mat-icon class="feat-check" [class.yes]="feat.included" [class.no]="!feat.included">
                  {{ feat.included ? 'check_circle' : 'cancel' }}
                </mat-icon>
                <span>{{ feat.name }}</span>
              </div>
            }
          </div>

          <!-- Actions -->
          <div class="pc-actions">
            <button type="button" class="pca-primary" [style.background]="plan.gradient" (click)="editPlan(plan)">
              <mat-icon>edit</mat-icon>
              Edit Plan
            </button>
            <div class="pca-secondary">
              <button type="button" class="pca-icon" [matTooltip]="plan.status === 'active' ? 'Deactivate' : 'Activate'" (click)="togglePlanStatus(plan)">
                <mat-icon>{{ plan.status === 'active' ? 'toggle_on' : 'toggle_off' }}</mat-icon>
              </button>
              <button type="button" class="pca-icon pca-del" matTooltip="Delete plan" (click)="deletePlan(plan)">
                <mat-icon>delete_outline</mat-icon>
              </button>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Offers Section -->
    <div class="section-head section-head--offers">
      <div class="sh-left">
        <h2 class="section-title">Active Offers</h2>
        <p class="section-sub">Special promotions and discount codes</p>
      </div>
      <div class="sh-right">
        <button type="button" class="add-plan-btn" (click)="addNewPlan()">
          <mat-icon>add</mat-icon>
          Add Offer
        </button>
      </div>
    </div>

    <div class="offers-grid">
      @for (offer of offers; track offer.id) {
        <div class="offer-card">
          <div class="oc-accent" [style.background]="offer.color"></div>
          <div class="oc-body">
            <div class="oc-head">
              <div class="oc-icon" [style.background]="offer.color + '18'" [style.color]="offer.color">
                <mat-icon>{{ offer.icon }}</mat-icon>
              </div>
              <div class="oc-discount" [style.background]="offer.color + '14'" [style.color]="offer.color">
                {{ offer.discount }}
              </div>
            </div>
            <div class="oc-title">{{ offer.title }}</div>
            <div class="oc-desc">{{ offer.description }}</div>
            <div class="oc-meta">
              <div class="oc-code" (click)="copyCode(offer.code)" matTooltip="Click to copy">
                <mat-icon>content_copy</mat-icon>
                <span>{{ offer.code }}</span>
              </div>
              <div class="oc-expires">
                <mat-icon>schedule</mat-icon>
                <span>{{ offer.daysLeft }} days left</span>
              </div>
            </div>
            <div class="oc-plans">
              @for (p of offer.applicablePlans; track p) {
                <span class="oc-plan-chip">{{ p }}</span>
              }
            </div>
            <div class="oc-actions">
              <button type="button" class="oca-edit" (click)="editOffer(offer)">
                <mat-icon>edit</mat-icon>
                Edit
              </button>
              <button type="button" class="oca-del" (click)="deleteOffer(offer)">
                <mat-icon>delete_outline</mat-icon>
              </button>
            </div>
          </div>
        </div>
      }
    </div>

  </div>
</app-page>
