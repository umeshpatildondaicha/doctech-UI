<app-page [breadcrumb]="breadcrumb" [isFooter]="false">
  <div page-body class="plans-page">

    <!-- ═══ STATS OVERVIEW ═══════════════════════════════════════════════ -->
    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-icon-wrap stat-icon-wrap--blue">
          <mat-icon>inventory_2</mat-icon>
        </div>
        <div class="stat-body">
          <span class="stat-val">{{ services.length }}</span>
          <span class="stat-lbl">Total Services</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon-wrap stat-icon-wrap--green">
          <mat-icon>verified</mat-icon>
        </div>
        <div class="stat-body">
          <span class="stat-val">{{ purchasedServices().length }}</span>
          <span class="stat-lbl">Subscribed</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon-wrap stat-icon-wrap--teal">
          <mat-icon>tune</mat-icon>
        </div>
        <div class="stat-body">
          <span class="stat-val">{{ totalActiveFeatures() }}</span>
          <span class="stat-lbl">Active Features</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon-wrap stat-icon-wrap--purple">
          <mat-icon>medical_services</mat-icon>
        </div>
        <div class="stat-body">
          <span class="stat-val">{{ totalDoctorsEquipped() }}</span>
          <span class="stat-lbl">Doctors Equipped</span>
        </div>
      </div>

      <div class="stat-card stat-card--spend">
        <div class="stat-icon-wrap stat-icon-wrap--orange">
          <mat-icon>currency_rupee</mat-icon>
        </div>
        <div class="stat-body">
          <span class="stat-val">₹{{ monthlySpend() | number }}</span>
          <span class="stat-lbl">Monthly Spend</span>
        </div>
      </div>
    </div>

    <!-- ═══ SERVICE CATALOG ════════════════════════════════════════════════ -->
    <div class="tab-pane">

        <!-- Header row -->
        <div class="section-head">
          <div class="sh-text">
            <h2 class="sh-title">Choose Your Service Package</h2>
            <p class="sh-sub">Purchase services to unlock specialized features for your medical staff</p>
          </div>
          <div class="billing-toggle">
            <span class="bt-label" [class.active]="billingCycle() === 'monthly'">Monthly</span>
            <button
              type="button"
              class="bt-pill"
              [class.yearly]="billingCycle() === 'yearly'"
              (click)="billingCycle.set(billingCycle() === 'monthly' ? 'yearly' : 'monthly')"
              [attr.aria-label]="'Switch to ' + (billingCycle() === 'monthly' ? 'yearly' : 'monthly') + ' billing'"
            >
              <span class="bt-knob"></span>
            </button>
            <span class="bt-label" [class.active]="billingCycle() === 'yearly'">
              Yearly
              <span class="save-badge">Save 17%</span>
            </span>
          </div>
        </div>

        <!-- Services grid -->
        <div class="services-grid">
          @for (svc of services; track svc.id) {
            <article class="svc-card" [class.svc-card--purchased]="svc.status === 'purchased'" [class.svc-card--popular]="svc.popular">

              <!-- Badge ribbon -->
              @if (svc.badge) {
                <div class="svc-ribbon" [style.background]="svc.gradient">{{ svc.badge }}</div>
              }

              <!-- Gradient header -->
              <div class="svc-header" [style.background]="svc.gradient">
                <div class="svc-category-tag">{{ svc.category }}</div>

                @if (svc.status === 'purchased') {
                  <div class="svc-subscribed-pill">
                    <mat-icon>verified</mat-icon>
                    Subscribed
                  </div>
                }

                <div class="svc-icon-circle">
                  <mat-icon>{{ svc.icon }}</mat-icon>
                </div>
                <h3 class="svc-name">{{ svc.name }}</h3>
                <p class="svc-tagline">{{ svc.tagline }}</p>
              </div>

              <!-- Features list -->
              <div class="svc-features">
                <div class="features-heading">
                  <mat-icon>checklist</mat-icon>
                  Included Features
                  <span class="features-count">{{ svc.features.length }}</span>
                </div>
                <ul class="features-list">
                  @for (feat of svc.features; track feat.id) {
                    <li class="feat-row">
                      <span class="feat-dot" [style.background]="svc.color"></span>
                      <mat-icon class="feat-icon" [style.color]="svc.color">{{ feat.icon }}</mat-icon>
                      <span class="feat-name">{{ feat.name }}</span>
                    </li>
                  }
                </ul>
              </div>

              <!-- Pricing & CTA -->
              <div class="svc-footer">
                <div class="svc-price-block">
                  <div class="price-row">
                    <span class="price-currency">{{ svc.currency }}</span>
                    <span class="price-amount">{{ getPrice(svc) | number }}</span>
                    <span class="price-period">/{{ billingCycle() === 'monthly' ? 'mo' : 'yr' }}</span>
                  </div>
                  @if (billingCycle() === 'yearly') {
                    <div class="price-savings">
                      <mat-icon>savings</mat-icon>
                      Save {{ svc.currency }}{{ getSavings(svc) | number }}/year
                    </div>
                  }
                </div>

                @if (svc.status === 'purchased') {
                  <div class="svc-btn svc-btn--subscribed">
                    <mat-icon>check_circle</mat-icon>
                    Subscribed
                  </div>
                } @else {
                  <button
                    type="button"
                    class="svc-btn svc-btn--subscribe"
                    [style.background]="svc.gradient"
                    (click)="subscribeToService(svc)"
                  >
                    <mat-icon>add_circle_outline</mat-icon>
                    Subscribe Now
                  </button>
                }
              </div>

            </article>
          }
        </div>

      </div>

  </div>
</app-page>
