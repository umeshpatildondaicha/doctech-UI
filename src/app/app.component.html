<!-- Use @if() to ensure only one view renders at a time -->
@if (viewMode === 'login') {
  <!-- Show login page without sidebar and header -->
  <div class="login-view">
    <router-outlet></router-outlet>
  </div>
} @else {
  <!-- Show main app layout with sidebar and header for authenticated users -->
  <div class="app-layout theme-teal" [class.sidebar-collapsed]="sidebarCollapsed">
    <app-sidebar [collapsed]="sidebarCollapsed" (toggle)="toggleSidebar()"></app-sidebar>

    <div class="main-section">
      <app-topbar (openPatientQueue)="onOpenPatientQueue($event)"></app-topbar>

      <main class="main-content">
        <router-outlet></router-outlet>
      </main>
    </div>
  </div>

  <div
    class="right-sidebar-backdrop"
    [class.visible]="rightSidebarOpened"
    (click)="closeRightSidebar()"
  ></div>

  <aside class="right-sidebar" [class.opened]="rightSidebarOpened">
    <div class="sidebar-header">
      <div class="header-content">
        <h2>Patient Queue</h2>
        <button type="button" class="close-btn" (click)="closeRightSidebar()" aria-label="Close patient queue">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="queue-stats">
        <div class="stat-item">
          <span class="stat-number">{{ getStatusCount('waiting') }}</span>
          <span class="stat-label">Waiting</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ getStatusCount('in-progress') }}</span>
          <span class="stat-label">In Progress</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ getStatusCount('completed') }}</span>
          <span class="stat-label">Completed</span>
        </div>
      </div>
    </div>

    <div class="sidebar-content">
      @for (status of ['waiting', 'in-progress', 'completed']; track status) {
        <div class="status-section">
          @if (getStatusCount(status) > 0) {
            <div class="status-header">
              <div class="status-title">
                <mat-icon [style.color]="getStatusColor(status)">{{ getStatusIcon(status) }}</mat-icon>
                <span>{{ status | titlecase }}</span>
                <span class="count-badge">{{ getStatusCount(status) }}</span>
              </div>
            </div>
          }
          <div class="patient-list">
            @for (patient of getFilteredPatients(status); track patient) {
              <div
                class="patient-item"
                (click)="onPatientClick(patient)"
                >
                <div class="patient-avatar">
                  @if (patient.avatar) {
                    <img
                      [src]="patient.avatar"
                      [alt]="patient.name"
                      class="avatar-img"
                      />
                  }
                  @if (!patient.avatar) {
                    <div
                      class="avatar-placeholder"
                      [style.background-color]="getPriorityColor(patient.priority)"
                      >
                      {{ patient.name.charAt(0) }}
                    </div>
                  }
                </div>
                <div class="patient-info">
                  <div class="patient-name">{{ patient.name }}</div>
                  <div class="patient-details">
                    <span class="patient-reason">{{ patient.reason }}</span>
                    @if (patient.room) {
                      <span class="patient-room">â€¢ Room {{ patient.room }}</span>
                    }
                  </div>
                  <div class="patient-time">{{ patient.estimatedTime }}</div>
                </div>
                <div class="patient-priority">
                  <mat-chip
                    [style.background-color]="getPriorityColor(patient.priority)"
                    [style.color]="'white'"
                    class="priority-chip"
                    >
                    <mat-icon class="priority-icon">{{ getPriorityIcon(patient.priority) }}</mat-icon>
                    {{ patient.priority | titlecase }}
                  </mat-chip>
                </div>
              </div>
            }
          </div>
          @if (getStatusCount(status) > 0 && status !== 'completed') {
            <mat-divider></mat-divider>
          }
        </div>
      }

      @if (patientQueue.length === 0) {
        <div class="empty-state">
          <mat-icon class="empty-icon">people_outline</mat-icon>
          <p>No patients in queue</p>
          <span>All patients have been attended to</span>
        </div>
      }
    </div>
  </aside>
}