<div class="diet-plan-card">
  <button type="button" class="card-top" (click)="onCardClick()" (keydown)="onKeyActivate($event)">
    <div class="card-header">
      <h3 class="card-title">{{ plan.name }}</h3>
      <span class="status-pill" [class.active]="isActive">{{ plan.status }}</span>
    </div>

    @if (plan.description) {
      <p class="card-description">{{ plan.description }}</p>
    }

    <div class="divider"></div>

    <div class="stats-grid">
      <div class="stat">
        <mat-icon class="stat-icon">groups</mat-icon>
        <div class="stat-text">
          <div class="stat-label">Duration</div>
          <div class="stat-value">{{ plan.duration }} Days</div>
        </div>
      </div>

      <div class="stat">
        <mat-icon class="stat-icon">schedule</mat-icon>
        <div class="stat-text">
          <div class="stat-label">Total Diets</div>
          <div class="stat-value">{{ plan.dietsCount || 0 }} Diets</div>
        </div>
      </div>

      <div class="stat">
        <mat-icon class="stat-icon">my_location</mat-icon>
        <div class="stat-text">
          <div class="stat-label">Goal</div>
          <div class="stat-value">{{ plan.goal || '—' }}</div>
        </div>
      </div>

      <div class="stat">
        <mat-icon class="stat-icon">calendar_month</mat-icon>
        <div class="stat-text">
          <div class="stat-label">Progress</div>
          <div class="stat-value">{{ plan.progress ?? 0 }}%</div>
        </div>
      </div>
    </div>
  </button>

  <div class="meals-section">
    <div class="meals-header">
      <div class="meals-title">Meals Included</div>
    </div>

    @if (plan.mealsIncluded && plan.mealsIncluded.length > 0) {
      <div class="meal-list">
        @for (meal of plan.mealsIncluded; track meal) {
          <div class="meal-item">
            <div class="meal-thumb">
              @if (meal.imageUrl) {
                <img [src]="meal.imageUrl" [alt]="meal.title" />
              }
              @if (!meal.imageUrl) {
                <div class="thumb-placeholder">
                  <mat-icon>restaurant</mat-icon>
                </div>
              }
            </div>
            <div class="meal-content">
              <div class="meal-name">{{ meal.title }}</div>
              @if (meal.subtitle) {
                <div class="meal-subtitle">{{ meal.subtitle }}</div>
              }
              @if (meal.tags && meal.tags.length > 0) {
                <div class="meal-tags">
                  {{ meal.tags.join('  •  ') }}
                </div>
              }
            </div>
          </div>
        }
      </div>
    }
  </div>

  @if (showFooter) {
    <div class="card-footer">
      <div class="reviewed">
        <div class="reviewed-label">Reviewed By</div>
        <div class="reviewed-meta">
          {{ plan.reviewedByName || '—' }}
          @if (plan.reviewedAt) {
            <span class="dot">•</span>
          }
          @if (plan.reviewedAt) {
            <span class="reviewed-date">{{ formatReviewedAt(plan.reviewedAt) }}</span>
          }
        </div>
      </div>
      @if (showActions) {
        <div class="footer-actions">
          <app-button
          appearance="icon"
          matTooltip="View"
          (click)="onView($event)">
          <mat-icon>visibility</mat-icon>
        </app-button>
        
        <app-button
          appearance="icon"
          matTooltip="Edit"
          (click)="onEdit($event)">
          <mat-icon>edit</mat-icon>
        </app-button>
        
        <app-button
          appearance="icon"
          matTooltip="Delete"
          (click)="onDelete($event)">
          <mat-icon>delete</mat-icon>
        </app-button>
        
        </div>
      }
    </div>
  }
</div>


